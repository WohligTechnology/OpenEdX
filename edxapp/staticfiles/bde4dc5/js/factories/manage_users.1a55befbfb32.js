define("js/utils/handle_iframe_binding",["jquery"],function(e){var t=function(t){var r=null;r="undefined"==typeof t?e("iframe, embed"):"undefined"!=typeof t.nodeName?e(t).find("iframe, embed"):t.$("iframe, embed"),n(r)},n=function(t){t.each(function(){if("IFRAME"===e(this).prop("tagName")){var t=e(this).attr("src");if(t){var n="wmode=transparent";if(-1!==t.indexOf("?")){var r=t.split("?");if(-1===r[1].search("wmode=transparent")){var i=r[1],s=r[0];e(this).attr("src",s+"?"+n+"&"+i)}}else 0!==t.lastIndexOf("javascript:",0)&&e(this).attr("src",t+"?"+n)}}else e(this).attr("wmode","transparent")})},r=function(t){if(t){var r=null,i=document.createElement("div");e(i).html(t),r=e(i).find("iframe, embed"),r.length>0&&(n(r),t=e(i).html())}return t};return{iframeBinding:t,iframeBindingHtml:r}}),define("js/utils/templates",["jquery","underscore"],function(e,t){var n=function(n){var r="#"+n+"-tpl",i=e(r).text();return i||console.error("Failed to load "+n+" template"),t.template(i)};return{loadTemplate:n}}),!function(e,t){var n=t.prototype.trim,r=t.prototype.trimRight,i=t.prototype.trimLeft,s=function(e){return 1*e||0},a=function(e,t){if(1>t)return"";for(var n="";t>0;)1&t&&(n+=e),t>>=1,e+=e;return n},o=[].slice,l=function(e){return null==e?"\\s":e.source?e.source:"["+h.escapeRegExp(e)+"]"},u={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"},c={};for(var d in u)c[u[d]]=d;var p=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var n=a,r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};return r.format=function(r,i){var s,a,o,l,u,c,d,h=1,f=r.length,m="",g=[];for(a=0;f>a;a++)if(m=e(r[a]),"string"===m)g.push(r[a]);else if("array"===m){if(l=r[a],l[2])for(s=i[h],o=0;o<l[2].length;o++){if(!s.hasOwnProperty(l[2][o]))throw new Error(p('[_.sprintf] property "%s" does not exist',l[2][o]));s=s[l[2][o]]}else s=l[1]?i[l[1]]:i[h++];if(/[^s]/.test(l[8])&&"number"!=e(s))throw new Error(p("[_.sprintf] expecting number but found %s",e(s)));switch(l[8]){case"b":s=s.toString(2);break;case"c":s=t.fromCharCode(s);break;case"d":s=parseInt(s,10);break;case"e":s=l[7]?s.toExponential(l[7]):s.toExponential();break;case"f":s=l[7]?parseFloat(s).toFixed(l[7]):parseFloat(s);break;case"o":s=s.toString(8);break;case"s":s=(s=t(s))&&l[7]?s.substring(0,l[7]):s;break;case"u":s=Math.abs(s);break;case"x":s=s.toString(16);break;case"X":s=s.toString(16).toUpperCase()}s=/[def]/.test(l[8])&&l[3]&&s>=0?"+"+s:s,c=l[4]?"0"==l[4]?"0":l[4].charAt(1):" ",d=l[6]-t(s).length,u=l[6]?n(c,d):"",g.push(l[5]?s+u:u+s)}return g.join("")},r.cache={},r.parse=function(e){for(var t=e,n=[],r=[],i=0;t;){if(null!==(n=/^[^\x25]+/.exec(t)))r.push(n[0]);else if(null!==(n=/^\x25{2}/.exec(t)))r.push("%");else{if(null===(n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw new Error("[_.sprintf] huh?");if(n[2]){i|=1;var s=[],a=n[2],o=[];if(null===(o=/^([a-z_][a-z_\d]*)/i.exec(a)))throw new Error("[_.sprintf] huh?");for(s.push(o[1]);""!==(a=a.substring(o[0].length));)if(null!==(o=/^\.([a-z_][a-z_\d]*)/i.exec(a)))s.push(o[1]);else{if(null===(o=/^\[(\d+)\]/.exec(a)))throw new Error("[_.sprintf] huh?");s.push(o[1])}n[2]=s}else i|=2;if(3===i)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");r.push(n)}t=t.substring(n[0].length)}return r},r}(),h={VERSION:"2.3.0",isBlank:function(e){return null==e&&(e=""),/^\s*$/.test(e)},stripTags:function(e){return null==e?"":t(e).replace(/<\/?[^>]+>/g,"")},capitalize:function(e){return e=null==e?"":t(e),e.charAt(0).toUpperCase()+e.slice(1)},chop:function(e,n){return null==e?[]:(e=t(e),n=~~n,n>0?e.match(new RegExp(".{1,"+n+"}","g")):[e])},clean:function(e){return h.strip(e).replace(/\s+/g," ")},count:function(e,n){return null==e||null==n?0:t(e).split(n).length-1},chars:function(e){return null==e?[]:t(e).split("")},swapCase:function(e){return null==e?"":t(e).replace(/\S/g,function(e){return e===e.toUpperCase()?e.toLowerCase():e.toUpperCase()})},escapeHTML:function(e){return null==e?"":t(e).replace(/[&<>"']/g,function(e){return"&"+c[e]+";"})},unescapeHTML:function(e){return null==e?"":t(e).replace(/\&([^;]+);/g,function(e,n){var r;return n in u?u[n]:(r=n.match(/^#x([\da-fA-F]+)$/))?t.fromCharCode(parseInt(r[1],16)):(r=n.match(/^#(\d+)$/))?t.fromCharCode(~~r[1]):e})},escapeRegExp:function(e){return null==e?"":t(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(e,t,n,r){var i=h.chars(e);return i.splice(~~t,~~n,r),i.join("")},insert:function(e,t,n){return h.splice(e,t,0,n)},include:function(e,n){return""===n?!0:null==e?!1:-1!==t(e).indexOf(n)},join:function(){var e=o.call(arguments),t=e.shift();return null==t&&(t=""),e.join(t)},lines:function(e){return null==e?[]:t(e).split("\n")},reverse:function(e){return h.chars(e).reverse().join("")},startsWith:function(e,n){return""===n?!0:null==e||null==n?!1:(e=t(e),n=t(n),e.length>=n.length&&e.slice(0,n.length)===n)},endsWith:function(e,n){return""===n?!0:null==e||null==n?!1:(e=t(e),n=t(n),e.length>=n.length&&e.slice(e.length-n.length)===n)},succ:function(e){return null==e?"":(e=t(e),e.slice(0,-1)+t.fromCharCode(e.charCodeAt(e.length-1)+1))},titleize:function(e){return null==e?"":t(e).replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},camelize:function(e){return h.trim(e).replace(/[-_\s]+(.)?/g,function(e,t){return t.toUpperCase()})},underscored:function(e){return h.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(e){return h.trim(e).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(e){return h.titleize(t(e).replace(/_/g," ")).replace(/\s/g,"")},humanize:function(e){return h.capitalize(h.underscored(e).replace(/_id$/,"").replace(/_/g," "))},trim:function(e,r){return null==e?"":!r&&n?n.call(e):(r=l(r),t(e).replace(new RegExp("^"+r+"+|"+r+"+$","g"),""))},ltrim:function(e,n){return null==e?"":!n&&i?i.call(e):(n=l(n),t(e).replace(new RegExp("^"+n+"+"),""))},rtrim:function(e,n){return null==e?"":!n&&r?r.call(e):(n=l(n),t(e).replace(new RegExp(n+"+$"),""))},truncate:function(e,n,r){return null==e?"":(e=t(e),r=r||"...",n=~~n,e.length>n?e.slice(0,n)+r:e)},prune:function(e,n,r){if(null==e)return"";if(e=t(e),n=~~n,r=null!=r?t(r):"...",e.length<=n)return e;var i=function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "},s=e.slice(0,n+1).replace(/.(?=\W*\w*$)/g,i);return s=s.slice(s.length-2).match(/\w\w/)?s.replace(/\s*\S+$/,""):h.rtrim(s.slice(0,s.length-1)),(s+r).length>e.length?e:e.slice(0,s.length)+r},words:function(e,t){return h.isBlank(e)?[]:h.trim(e,t).split(t||/\s+/)},pad:function(e,n,r,i){e=null==e?"":t(e),n=~~n;var s=0;switch(r?r.length>1&&(r=r.charAt(0)):r=" ",i){case"right":return s=n-e.length,e+a(r,s);case"both":return s=n-e.length,a(r,Math.ceil(s/2))+e+a(r,Math.floor(s/2));default:return s=n-e.length,a(r,s)+e}},lpad:function(e,t,n){return h.pad(e,t,n)},rpad:function(e,t,n){return h.pad(e,t,n,"right")},lrpad:function(e,t,n){return h.pad(e,t,n,"both")},sprintf:p,vsprintf:function(e,t){return t.unshift(e),p.apply(null,t)},toNumber:function(e,n){if(null==e||""==e)return 0;e=t(e);var r=s(s(e).toFixed(~~n));return 0!==r||e.match(/^0+$/)?r:Number.NaN},numberFormat:function(e,t,n,r){if(isNaN(e)||null==e)return"";e=e.toFixed(~~t),r=r||",";var i=e.split("."),s=i[0],a=i[1]?(n||".")+i[1]:"";return s.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+r)+a},strRight:function(e,n){if(null==e)return"";e=t(e),n=null!=n?t(n):n;var r=n?e.indexOf(n):-1;return~r?e.slice(r+n.length,e.length):e},strRightBack:function(e,n){if(null==e)return"";e=t(e),n=null!=n?t(n):n;var r=n?e.lastIndexOf(n):-1;return~r?e.slice(r+n.length,e.length):e},strLeft:function(e,n){if(null==e)return"";e=t(e),n=null!=n?t(n):n;var r=n?e.indexOf(n):-1;return~r?e.slice(0,r):e},strLeftBack:function(e,t){if(null==e)return"";e+="",t=null!=t?""+t:t;var n=e.lastIndexOf(t);return~n?e.slice(0,n):e},toSentence:function(e,t,n,r){t=t||", ",n=n||" and ";var i=e.slice(),s=i.pop();return e.length>2&&r&&(n=h.rtrim(t)+n),i.length?i.join(t)+n+s:s},toSentenceSerial:function(){var e=o.call(arguments);return e[3]=!0,h.toSentence.apply(h,e)},slugify:function(e){if(null==e)return"";var n="ąàáäâãåæćęèéëêìíïîłńòóöôõøùúüûñçżź",r="aaaaaaaaceeeeeiiiilnoooooouuuunczz",i=new RegExp(l(n),"g");return e=t(e).toLowerCase().replace(i,function(e){var t=n.indexOf(e);return r.charAt(t)||"-"}),h.dasherize(e.replace(/[^\w\s-]/g,""))},surround:function(e,t){return[t,e,t].join("")},quote:function(e){return h.surround(e,'"')},exports:function(){var e={};for(var t in this)this.hasOwnProperty(t)&&!t.match(/^(?:include|contains|reverse)$/)&&(e[t]=this[t]);return e},repeat:function(e,n,r){if(null==e)return"";if(n=~~n,null==r)return a(t(e),n);for(var i=[];n>0;i[--n]=e);return i.join(r)},levenshtein:function(e,n){if(null==e&&null==n)return 0;if(null==e)return t(n).length;if(null==n)return t(e).length;e=t(e),n=t(n);for(var r,i,s=[],a=0;a<=n.length;a++)for(var o=0;o<=e.length;o++)i=a&&o?e.charAt(o-1)===n.charAt(a-1)?r:Math.min(s[o],s[o-1],r)+1:a+o,r=s[o],s[o]=i;return s.pop()}};h.strip=h.trim,h.lstrip=h.ltrim,h.rstrip=h.rtrim,h.center=h.lrpad,h.rjust=h.lpad,h.ljust=h.rpad,h.contains=h.include,h.q=h.quote,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(module.exports=h),exports._s=h):"function"==typeof define&&define.amd?define("underscore.string",[],function(){return h}):(e._=e._||{},e._.string=e._.str=h)}(this,String),define("js/views/feedback",["jquery","underscore","underscore.string","backbone","js/utils/templates"],function(e,t,n,r,i){var s=r.View.extend({options:{title:"",message:"",intent:null,type:null,shown:!0,icon:!0,closeIcon:!0,minShown:0,maxShown:1/0},initialize:function(){if(!this.options.type)throw"SystemFeedback: type required (given "+JSON.stringify(this.options)+")";if(!this.options.intent)throw"SystemFeedback: intent required (given "+JSON.stringify(this.options)+")";return this.template=i.loadTemplate("system-feedback"),this.setElement(e("#page-"+this.options.type)),this.options.actions&&this.options.actions.secondary&&!t.isArray(this.options.actions.secondary)&&(this.options.actions.secondary=[this.options.actions.secondary]),this},show:function(){return clearTimeout(this.hideTimeout),this.options.shown=!0,this.shownAt=new Date,this.render(),e.isNumeric(this.options.maxShown)&&(this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.maxShown)),this},hide:function(){return this.shownAt&&e.isNumeric(this.options.minShown)&&this.options.minShown>new Date-this.shownAt?(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.minShown-(new Date-this.shownAt))):(this.options.shown=!1,delete this.shownAt,this.render()),this},events:{"click .action-close":"hide","click .action-primary":"primaryClick","click .action-secondary":"secondaryClick"},render:function(){var e=s["active_"+this.options.type];return e&&e!==this&&(e.stopListening(),e.undelegateEvents()),this.$el.html(this.template(this.options)),s["active_"+this.options.type]=this,this},primaryClick:function(e){var t,n;t=this.options.actions,t&&(n=t.primary,n&&(n.preventDefault!==!1&&e.preventDefault(),n.click&&n.click.call(e.target,this,e)))},secondaryClick:function(e){var n,r,i,s;n=this.options.actions,n&&(r=n.secondary,r&&(s=0,e&&e.target&&(s=t.indexOf(this.$(".action-secondary"),e.target)),i=r[s],i.preventDefault!==!1&&e.preventDefault(),i.click&&i.click.call(e.target,this,e)))}});return s}),define("js/views/feedback_notification",["jquery","underscore","underscore.string","js/views/feedback"],function(e,t,n,r){var i,s,a=r.extend({options:e.extend({},r.prototype.options,{type:"notification",closeIcon:!1})});i=t.compose(n.capitalize,n.camelize),s=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(s,function(t){var n;n=a.extend({options:e.extend({},a.prototype.options,{intent:t})}),a[i(t)]=n});var o=a.Mini.prototype.options;return o.minShown=1250,o.closeIcon=!1,a}),define("js/views/feedback_prompt",["jquery","underscore","underscore.string","js/views/feedback"],function(e,t,n,r){var i,s,a=r.extend({options:e.extend({},r.prototype.options,{type:"prompt",closeIcon:!1,icon:!1}),render:function(){return window.$body||(window.$body=e(document.body)),this.options.shown?$body.addClass("prompt-is-shown"):$body.removeClass("prompt-is-shown"),r.prototype.render.apply(this,arguments)}});return i=t.compose(n.capitalize,n.camelize),s=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(s,function(t){var n;n=a.extend({options:e.extend({},a.prototype.options,{intent:t})}),a[i(t)]=n}),a}),define("js/views/utils/view_utils",["jquery","underscore","gettext","js/views/feedback_notification","js/views/feedback_prompt"],function(e,t,n,r,i){var s,a,o,l,u,c,d,p,h,f,m,g,v,w,y,b,x,k=65;return s=function(e,t){t||(t="collapsed"),e.closest(".expand-collapse").toggleClass("expand collapse"),e.closest(".is-collapsible, .window").toggleClass(t),e.closest(".is-collapsible").children("article").slideToggle()},a=function(){e(".ui-loading").show()},o=function(){e(".ui-loading").hide()},l=function(e,t,r,s,a){return new i.Warning({title:e,message:t,actions:{primary:{text:r,click:function(e){e.hide(),s()}},secondary:{text:n("Cancel"),click:function(e){return a&&a(),e.hide()}}}}).show()},u=function(e,t){var i;return i=new r.Mini({title:n(e)}),i.show(),t().done(function(){i.hide()})},c=function(e,t){return e.addClass("is-disabled").attr("aria-disabled",!0),t().always(function(){e.removeClass("is-disabled").attr("aria-disabled",!1)})},v=function(t){return function(n){n.preventDefault(),e.ajax({url:e(this).data("dismiss-link"),type:"DELETE",success:t})}},h=function(t){e("html, body").animate({scrollTop:t},500)},d=function(t){var n=t.offset().top;return n-e(window).scrollTop()},p=function(e,t){var n=e.offset().top,r=n-t;h(r)},f=function(e){window.location=e},m=function(){window.location.reload()},g=function(e,n){var r,i=e.changedAttributes();if(!i)return!1;for(r=0;r<n.length;r++)if(t.has(i,n[r]))return!0;return!1},w=function(e){return 0===e.length?n("Required field."):""},y=function(e,t){var r=w(e);if(r)return r;if(t){if(/\s/g.test(e))return n("Please do not use any spaces in this field.")}else if(e!==encodeURIComponent(e)||e.match(/[!'()*]/))return n("Please do not use any spaces or special characters in this field.");return""},b=function(n){var r=t.reduce(n,function(t,n){return t+e(n).val().length},0);return k>=r},x=function(n,r,i,s){b(i)?e(n.errorWrapper).removeClass(r.shown).addClass(r.hiding):(e(n.errorWrapper).addClass(r.shown).removeClass(r.hiding),e(n.errorMessage).html("<p>"+t.template(s,{limit:k})+"</p>"),e(n.save).addClass(r.disabled))},{toggleExpandCollapse:s,showLoadingIndicator:a,hideLoadingIndicator:o,confirmThenRunOperation:l,runOperationShowingMessage:u,disableElementWhileRunning:c,deleteNotificationHandler:v,setScrollTop:h,getScrollOffset:d,setScrollOffset:p,redirect:f,reload:m,hasChangedAttributes:g,validateRequiredField:w,validateURLItemEncoding:y,validateTotalKeyLength:b,checkTotalKeyLengthViolations:x}}),define("js/views/baseview",["jquery","underscore","backbone","gettext","js/utils/handle_iframe_binding","js/utils/templates","js/views/utils/view_utils"],function(e,t,n,r,i,s,a){var o=n.View.extend({events:{"click .ui-toggle-expansion":"toggleExpandCollapse"},options:{collapsedClass:"collapsed"},constructor:function(){t.bindAll(this,"beforeRender","render","afterRender");var e=this;this.render=t.wrap(this.render,function(t,n){return e.beforeRender(),t(n),e.afterRender(),e}),n.View.prototype.constructor.apply(this,arguments)},beforeRender:function(){},render:function(){return this},afterRender:function(){i.iframeBinding(this)},toggleExpandCollapse:function(t){var n=e(t.target);t.stopPropagation(),t.preventDefault(),a.toggleExpandCollapse(n,this.options.collapsedClass)},loadTemplate:function(e){return s.loadTemplate(e)}});return o}),define("js/views/manage_users_and_roles",["jquery","underscore","gettext","js/views/baseview","js/views/feedback_prompt","js/views/utils/view_utils"],function(e,t,n,r,i,s){function a(t){return new i.Error({title:t.invalidEmail.title,message:t.invalidEmail.message,actions:{primary:{text:t.invalidEmail.primaryAction,click:function(t){t.hide(),e("#user-email-input").focus()}}}})}function o(n,r,s){return new i.Warning({title:n.alreadyMember.title,message:t.template(n.alreadyMember.messageTpl,{email:r,container:s},{interpolate:/\{(.+?)}/g}),actions:{primary:{text:n.alreadyMember.primaryAction,click:function(t){t.hide(),e("#user-email-input").focus()}}}})}function l(e,t,n,r){return new i.Error({title:t,message:n,actions:{primary:{text:e.defaults.confirmation,click:function(e){e.hide(),r()}}}})}function u(t){return e(t).closest("li[data-email]").data("email")}var c={defaults:{confirmation:n("Ok"),changeRoleError:n("There was an error changing the user's role"),unknown:n("Unknown")},errors:{addUser:n("Error adding user"),deleteUser:n("Error removing user")},invalidEmail:{title:n("A valid email address is required"),message:n("You must enter a valid email address in order to add a new team member"),primaryAction:n("Return and add email address")},alreadyMember:{title:n("Already a member"),messageTpl:n("{email} is already on the {container} team. Recheck the email address if you want to add a new member."),primaryAction:n("Return to team listing")},deleteUser:{title:n("Are you sure?"),messageTpl:n("Are you sure you want to restrict {email} access to “{container}”?"),primaryAction:n("Delete"),secondaryAction:n("Cancel")}},d=r.extend({events:function(){for(var e={"click .create-user-button":"addUserHandler","submit #create-user-form":"createUserFormSubmit","click .action-cancel":"cancelEditHandler",keyup:"keyUpHandler","click .remove-user":"removeUserHandler"},n={},r=this,i=0;i<r.roles.length;i++){var s=r.roles[i].key,a="click .user-actions .make-"+s;!function(e){n[a]=function(t){r.handleRoleButtonClick(t.target,e)}}(s)}return t.extend(e,n)},initialize:function(e){r.prototype.initialize.call(this),this.containerName=e.containerName,this.tplUserURL=e.tplUserURL,this.roles=e.roles,this.users=e.users,this.allow_actions=e.allow_actions,this.current_user_id=e.current_user_id,this.initial_role=this.roles[0],this.admin_role=this.roles[this.roles.length-1];var t=e.messages_modifier||function(e){return e};this.messages=t(c),this.$userEmailInput=this.$el.find("#user-email-input"),this.$createUserButton=this.$el.find(".create-user-button"),this.$createUserFormWrapper=this.$el.find(".wrapper-create-user"),this.$cancelButton=this.$el.find(".action-cancel"),this.$userList=this.$el.find("#user-list")},render:function(){this.$userList.empty();for(var e=this.loadTemplate("team-member"),n=t.object(t.pluck(this.roles,"key"),t.pluck(this.roles,"name")),r=this.getAdminRoleCount(),i={format:function(e,n){return t.template(e,n,{interpolate:/\{(.+?)}/g})}},s=0;s<this.users.length;s++){var a=this.users[s],o=this.current_user_id==a.id,l={user:a,actions:this.getPossibleRoleChangesForRole(a.role,r),roles:n,allow_delete:!(a.role===this.admin_role.key&&1===r),allow_actions:this.allow_actions,is_current_user:o,viewHelpers:i};this.$userList.append(e(l))}},getAdminRoleCount:function(){var e=this;return t.filter(this.users,function(t){return t.role===e.admin_role.key}).length},getPossibleRoleChangesForRole:function(e,n){var r=[],i=t.map(this.roles,function(e){return e.key});if(e===this.admin_role.key&&1===n)r.push({notoggle:!0});else for(var s=t.indexOf(i,e),a=this.roles.length-1;a>=0;a--){var o=this.roles[a];1===Math.abs(s-a)&&r.push({to_role:o.key,label:s>a?this.roles[s].name:o.name,direction:s>a?"remove":"add"})}return r},checkEmail:function(e){var n=t.map(this.users,function(e){return e.email});return e?t.contains(n,e)?{valid:!1,msg:o(this.messages,e,this.containerName)}:{valid:!0}:{valid:!1,msg:a(this.messages)}},changeRole:function(t,n,r){var i=this,a=this.tplUserURL.replace("@@EMAIL@@",t),o=r.errMessage||this.messages.defaults.changeRoleError,u=r.onSuccess||function(){s.reload()},c=r.onError||function(){};e.ajax({url:a,type:n?"POST":"DELETE",dataType:"json",contentType:"application/json",data:JSON.stringify({role:n}),success:u,error:function(e){var t,n;try{t=JSON.parse(e.responseText).error||i.messages.defaults.unknown}catch(r){t=i.messages.defaults.unknown}n=l(i.messages,o,t,c),n.show()}})},handleRoleButtonClick:function(e,t){this.changeRole(u(e),t,{})},addUserHandler:function(e){e.preventDefault(),this.$createUserButton.toggleClass("is-disabled").attr("aria-disabled",this.$createUserButton.hasClass("is-disabled")),this.$createUserFormWrapper.toggleClass("is-shown"),this.$userEmailInput.focus()},cancelEditHandler:function(e){e.preventDefault(),this.$createUserButton.toggleClass("is-disabled").attr("aria-disabled",this.$createUserButton.hasClass("is-disabled")),this.$createUserFormWrapper.toggleClass("is-shown"),this.$userEmailInput.val("")},createUserFormSubmit:function(e){e.preventDefault();var t=this,n=this.$userEmailInput.val().trim(),r=this.checkEmail(n);return r.valid?void this.changeRole(n,this.initial_role.key,{errMessage:this.messages.errors.addUser,onError:function(){t.$userEmailInput.focus()}}):void r.msg.show()},keyUpHandler:function(e){e.which===jQuery.ui.keyCode.ESCAPE&&this.$createUserFormWrapper.is(".is-shown")&&this.$cancelButton.click()},removeUserHandler:function(e){e.preventDefault();var n=this,r=u(e.target),s=new i.Warning({title:n.messages.deleteUser.title,message:t.template(n.messages.deleteUser.messageTpl,{email:r,container:n.containerName},{interpolate:/\{(.+?)}/g}),actions:{primary:{text:n.messages.deleteUser.primaryAction,click:function(e){e.hide(),n.changeRole(r,null,{errMessage:n.messages.errors.deleteUser})}},secondary:{text:n.messages.deleteUser.secondaryAction,click:function(e){e.hide()}}}});s.show()}});return d}),define("js/factories/manage_users",["underscore","gettext","js/views/manage_users_and_roles"],function(e,t,n){return function(r,i,s,a,o){function l(n){var r=e.extend({},n);return r.alreadyMember.title=t("Already a course team member"),r.deleteUser.messageTpl=t("Are you sure you want to delete {email} from the course team for “{container}”?"),r}var u=[{key:"staff",name:t("Staff")},{key:"instructor",name:t("Admin")}],c={el:$("#content"),containerName:r,tplUserURL:s,roles:u,users:i,messages_modifier:l,current_user_id:a,allow_actions:o},d=new n(c);d.render()}});