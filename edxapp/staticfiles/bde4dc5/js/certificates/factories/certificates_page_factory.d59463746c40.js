/*!
 * jQuery Cookie Plugin
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */

/*!
 * jQuery Form Plugin
 * version: 3.18 (28-SEP-2012)
 * @requires jQuery v1.5 or later
 *
 * Examples and documentation at: http://malsup.com/jquery/form/
 * Project repository: https://github.com/malsup/form
 * Dual licensed under the MIT and GPL licenses:
 *    http://malsup.github.com/mit-license.txt
 *    http://malsup.github.com/gpl-license-v2.txt
 */

!function(e,t){var i=t.prototype.trim,n=t.prototype.trimRight,o=t.prototype.trimLeft,s=function(e){return 1*e||0},r=function(e,t){if(1>t)return"";for(var i="";t>0;)1&t&&(i+=e),t>>=1,e+=e;return i},a=[].slice,l=function(e){return null==e?"\\s":e.source?e.source:"["+f.escapeRegExp(e)+"]"},c={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"},u={};for(var d in c)u[c[d]]=d;var h=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var i=r,n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,o){var s,r,a,l,c,u,d,f=1,p=n.length,g="",m=[];for(r=0;p>r;r++)if(g=e(n[r]),"string"===g)m.push(n[r]);else if("array"===g){if(l=n[r],l[2])for(s=o[f],a=0;a<l[2].length;a++){if(!s.hasOwnProperty(l[2][a]))throw new Error(h('[_.sprintf] property "%s" does not exist',l[2][a]));s=s[l[2][a]]}else s=l[1]?o[l[1]]:o[f++];if(/[^s]/.test(l[8])&&"number"!=e(s))throw new Error(h("[_.sprintf] expecting number but found %s",e(s)));switch(l[8]){case"b":s=s.toString(2);break;case"c":s=t.fromCharCode(s);break;case"d":s=parseInt(s,10);break;case"e":s=l[7]?s.toExponential(l[7]):s.toExponential();break;case"f":s=l[7]?parseFloat(s).toFixed(l[7]):parseFloat(s);break;case"o":s=s.toString(8);break;case"s":s=(s=t(s))&&l[7]?s.substring(0,l[7]):s;break;case"u":s=Math.abs(s);break;case"x":s=s.toString(16);break;case"X":s=s.toString(16).toUpperCase()}s=/[def]/.test(l[8])&&l[3]&&s>=0?"+"+s:s,u=l[4]?"0"==l[4]?"0":l[4].charAt(1):" ",d=l[6]-t(s).length,c=l[6]?i(u,d):"",m.push(l[5]?s+c:c+s)}return m.join("")},n.cache={},n.parse=function(e){for(var t=e,i=[],n=[],o=0;t;){if(null!==(i=/^[^\x25]+/.exec(t)))n.push(i[0]);else if(null!==(i=/^\x25{2}/.exec(t)))n.push("%");else{if(null===(i=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw new Error("[_.sprintf] huh?");if(i[2]){o|=1;var s=[],r=i[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(r)))throw new Error("[_.sprintf] huh?");for(s.push(a[1]);""!==(r=r.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(r)))s.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(r)))throw new Error("[_.sprintf] huh?");s.push(a[1])}i[2]=s}else o|=2;if(3===o)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");n.push(i)}t=t.substring(i[0].length)}return n},n}(),f={VERSION:"2.3.0",isBlank:function(e){return null==e&&(e=""),/^\s*$/.test(e)},stripTags:function(e){return null==e?"":t(e).replace(/<\/?[^>]+>/g,"")},capitalize:function(e){return e=null==e?"":t(e),e.charAt(0).toUpperCase()+e.slice(1)},chop:function(e,i){return null==e?[]:(e=t(e),i=~~i,i>0?e.match(new RegExp(".{1,"+i+"}","g")):[e])},clean:function(e){return f.strip(e).replace(/\s+/g," ")},count:function(e,i){return null==e||null==i?0:t(e).split(i).length-1},chars:function(e){return null==e?[]:t(e).split("")},swapCase:function(e){return null==e?"":t(e).replace(/\S/g,function(e){return e===e.toUpperCase()?e.toLowerCase():e.toUpperCase()})},escapeHTML:function(e){return null==e?"":t(e).replace(/[&<>"']/g,function(e){return"&"+u[e]+";"})},unescapeHTML:function(e){return null==e?"":t(e).replace(/\&([^;]+);/g,function(e,i){var n;return i in c?c[i]:(n=i.match(/^#x([\da-fA-F]+)$/))?t.fromCharCode(parseInt(n[1],16)):(n=i.match(/^#(\d+)$/))?t.fromCharCode(~~n[1]):e})},escapeRegExp:function(e){return null==e?"":t(e).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(e,t,i,n){var o=f.chars(e);return o.splice(~~t,~~i,n),o.join("")},insert:function(e,t,i){return f.splice(e,t,0,i)},include:function(e,i){return""===i?!0:null==e?!1:-1!==t(e).indexOf(i)},join:function(){var e=a.call(arguments),t=e.shift();return null==t&&(t=""),e.join(t)},lines:function(e){return null==e?[]:t(e).split("\n")},reverse:function(e){return f.chars(e).reverse().join("")},startsWith:function(e,i){return""===i?!0:null==e||null==i?!1:(e=t(e),i=t(i),e.length>=i.length&&e.slice(0,i.length)===i)},endsWith:function(e,i){return""===i?!0:null==e||null==i?!1:(e=t(e),i=t(i),e.length>=i.length&&e.slice(e.length-i.length)===i)},succ:function(e){return null==e?"":(e=t(e),e.slice(0,-1)+t.fromCharCode(e.charCodeAt(e.length-1)+1))},titleize:function(e){return null==e?"":t(e).replace(/(?:^|\s)\S/g,function(e){return e.toUpperCase()})},camelize:function(e){return f.trim(e).replace(/[-_\s]+(.)?/g,function(e,t){return t.toUpperCase()})},underscored:function(e){return f.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(e){return f.trim(e).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(e){return f.titleize(t(e).replace(/_/g," ")).replace(/\s/g,"")},humanize:function(e){return f.capitalize(f.underscored(e).replace(/_id$/,"").replace(/_/g," "))},trim:function(e,n){return null==e?"":!n&&i?i.call(e):(n=l(n),t(e).replace(new RegExp("^"+n+"+|"+n+"+$","g"),""))},ltrim:function(e,i){return null==e?"":!i&&o?o.call(e):(i=l(i),t(e).replace(new RegExp("^"+i+"+"),""))},rtrim:function(e,i){return null==e?"":!i&&n?n.call(e):(i=l(i),t(e).replace(new RegExp(i+"+$"),""))},truncate:function(e,i,n){return null==e?"":(e=t(e),n=n||"...",i=~~i,e.length>i?e.slice(0,i)+n:e)},prune:function(e,i,n){if(null==e)return"";if(e=t(e),i=~~i,n=null!=n?t(n):"...",e.length<=i)return e;var o=function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "},s=e.slice(0,i+1).replace(/.(?=\W*\w*$)/g,o);return s=s.slice(s.length-2).match(/\w\w/)?s.replace(/\s*\S+$/,""):f.rtrim(s.slice(0,s.length-1)),(s+n).length>e.length?e:e.slice(0,s.length)+n},words:function(e,t){return f.isBlank(e)?[]:f.trim(e,t).split(t||/\s+/)},pad:function(e,i,n,o){e=null==e?"":t(e),i=~~i;var s=0;switch(n?n.length>1&&(n=n.charAt(0)):n=" ",o){case"right":return s=i-e.length,e+r(n,s);case"both":return s=i-e.length,r(n,Math.ceil(s/2))+e+r(n,Math.floor(s/2));default:return s=i-e.length,r(n,s)+e}},lpad:function(e,t,i){return f.pad(e,t,i)},rpad:function(e,t,i){return f.pad(e,t,i,"right")},lrpad:function(e,t,i){return f.pad(e,t,i,"both")},sprintf:h,vsprintf:function(e,t){return t.unshift(e),h.apply(null,t)},toNumber:function(e,i){if(null==e||""==e)return 0;e=t(e);var n=s(s(e).toFixed(~~i));return 0!==n||e.match(/^0+$/)?n:Number.NaN},numberFormat:function(e,t,i,n){if(isNaN(e)||null==e)return"";e=e.toFixed(~~t),n=n||",";var o=e.split("."),s=o[0],r=o[1]?(i||".")+o[1]:"";return s.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+n)+r},strRight:function(e,i){if(null==e)return"";e=t(e),i=null!=i?t(i):i;var n=i?e.indexOf(i):-1;return~n?e.slice(n+i.length,e.length):e},strRightBack:function(e,i){if(null==e)return"";e=t(e),i=null!=i?t(i):i;var n=i?e.lastIndexOf(i):-1;return~n?e.slice(n+i.length,e.length):e},strLeft:function(e,i){if(null==e)return"";e=t(e),i=null!=i?t(i):i;var n=i?e.indexOf(i):-1;return~n?e.slice(0,n):e},strLeftBack:function(e,t){if(null==e)return"";e+="",t=null!=t?""+t:t;var i=e.lastIndexOf(t);return~i?e.slice(0,i):e},toSentence:function(e,t,i,n){t=t||", ",i=i||" and ";var o=e.slice(),s=o.pop();return e.length>2&&n&&(i=f.rtrim(t)+i),o.length?o.join(t)+i+s:s},toSentenceSerial:function(){var e=a.call(arguments);return e[3]=!0,f.toSentence.apply(f,e)},slugify:function(e){if(null==e)return"";var i="ąàáäâãåæćęèéëêìíïîłńòóöôõøùúüûñçżź",n="aaaaaaaaceeeeeiiiilnoooooouuuunczz",o=new RegExp(l(i),"g");return e=t(e).toLowerCase().replace(o,function(e){var t=i.indexOf(e);return n.charAt(t)||"-"}),f.dasherize(e.replace(/[^\w\s-]/g,""))},surround:function(e,t){return[t,e,t].join("")},quote:function(e){return f.surround(e,'"')},exports:function(){var e={};for(var t in this)this.hasOwnProperty(t)&&!t.match(/^(?:include|contains|reverse)$/)&&(e[t]=this[t]);return e},repeat:function(e,i,n){if(null==e)return"";if(i=~~i,null==n)return r(t(e),i);for(var o=[];i>0;o[--i]=e);return o.join(n)},levenshtein:function(e,i){if(null==e&&null==i)return 0;if(null==e)return t(i).length;if(null==i)return t(e).length;e=t(e),i=t(i);for(var n,o,s=[],r=0;r<=i.length;r++)for(var a=0;a<=e.length;a++)o=r&&a?e.charAt(a-1)===i.charAt(r-1)?n:Math.min(s[a],s[a-1],n)+1:r+a,n=s[a],s[a]=o;return s.pop()}};f.strip=f.trim,f.lstrip=f.ltrim,f.rstrip=f.rtrim,f.center=f.lrpad,f.rjust=f.lpad,f.ljust=f.rpad,f.contains=f.include,f.q=f.quote,"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(module.exports=f),exports._s=f):"function"==typeof define&&define.amd?define("underscore.string",[],function(){return f}):(e._=e._||{},e._.string=e._.str=f)}(this,String),!function(e,t){"function"==typeof define&&define.amd?define("backbone-relational",["exports","backbone","underscore"],t):"undefined"!=typeof exports?t(exports,require("backbone"),require("underscore")):t(e,e.Backbone,e._)}(this,function(e,t,i){t.Relational={showWarnings:!0},t.Semaphore={_permitsAvailable:null,_permitsUsed:0,acquire:function(){if(this._permitsAvailable&&this._permitsUsed>=this._permitsAvailable)throw new Error("Max permits acquired");this._permitsUsed++},release:function(){if(0===this._permitsUsed)throw new Error("All permits released");this._permitsUsed--},isLocked:function(){return this._permitsUsed>0},setAvailablePermits:function(e){if(this._permitsUsed>e)throw new Error("Available permits cannot be less than used permits");this._permitsAvailable=e}},t.BlockingQueue=function(){this._queue=[]},i.extend(t.BlockingQueue.prototype,t.Semaphore,{_queue:null,add:function(e){this.isBlocked()?this._queue.push(e):e()},process:function(){var e=this._queue;for(this._queue=[];e&&e.length;)e.shift()()},block:function(){this.acquire()},unblock:function(){this.release(),this.isBlocked()||this.process()},isBlocked:function(){return this.isLocked()}}),t.Relational.eventQueue=new t.BlockingQueue,t.Store=function(){this._collections=[],this._reverseRelations=[],this._orphanRelations=[],this._subModels=[],this._modelScopes=[e]},i.extend(t.Store.prototype,t.Events,{initializeRelation:function(e,n,o){var s=i.isString(n.type)?t[n.type]||this.getObjectByName(n.type):n.type;s&&s.prototype instanceof t.Relation?new s(e,n,o):t.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Relation=%o; missing or invalid relation type!",n)},addModelScope:function(e){this._modelScopes.push(e)},removeModelScope:function(e){this._modelScopes=i.without(this._modelScopes,e)},addSubModels:function(e,t){this._subModels.push({superModelType:t,subModels:e})},setupSuperModel:function(e){i.find(this._subModels,function(t){return i.filter(t.subModels||[],function(i,n){var o=this.getObjectByName(i);return e===o?(t.superModelType._subModels[n]=e,e._superModel=t.superModelType,e._subModelTypeValue=n,e._subModelTypeAttribute=t.superModelType.prototype.subModelTypeAttribute,!0):void 0},this).length},this)},addReverseRelation:function(e){var t=i.any(this._reverseRelations,function(t){return i.all(e||[],function(e,i){return e===t[i]})});!t&&e.model&&e.type&&(this._reverseRelations.push(e),this._addRelation(e.model,e),this.retroFitRelation(e))},addOrphanRelation:function(e){var t=i.any(this._orphanRelations,function(t){return i.all(e||[],function(e,i){return e===t[i]})});!t&&e.model&&e.type&&this._orphanRelations.push(e)},processOrphanRelations:function(){i.each(this._orphanRelations.slice(0),function(e){var n=t.Relational.store.getObjectByName(e.relatedModel);n&&(this.initializeRelation(null,e),this._orphanRelations=i.without(this._orphanRelations,e))},this)},_addRelation:function(e,t){e.prototype.relations||(e.prototype.relations=[]),e.prototype.relations.push(t),i.each(e._subModels||[],function(e){this._addRelation(e,t)},this)},retroFitRelation:function(e){var t=this.getCollection(e.model,!1);t&&t.each(function(t){t instanceof e.model&&new e.type(t,e)},this)},getCollection:function(e,n){e instanceof t.RelationalModel&&(e=e.constructor);for(var o=e;o._superModel;)o=o._superModel;var s=i.find(this._collections,function(e){return e.model===o});return s||n===!1||(s=this._createCollection(o)),s},getObjectByName:function(e){var t=e.split("."),n=null;return i.find(this._modelScopes,function(e){return n=i.reduce(t||[],function(e,t){return e?e[t]:void 0},e),n&&n!==e?!0:void 0},this),n},_createCollection:function(e){var i;return e instanceof t.RelationalModel&&(e=e.constructor),e.prototype instanceof t.RelationalModel&&(i=new t.Collection,i.model=e,this._collections.push(i)),i},resolveIdForItem:function(e,n){var o=i.isString(n)||i.isNumber(n)?n:null;return null===o&&(n instanceof t.RelationalModel?o=n.id:i.isObject(n)&&(o=n[e.prototype.idAttribute])),o||0===o||(o=null),o},find:function(e,t){var i=this.resolveIdForItem(e,t),n=this.getCollection(e);if(n){var o=n.get(i);if(o instanceof e)return o}return null},register:function(e){var t=this.getCollection(e);if(t){var i=e.collection;t.add(e),e.collection=i}},checkId:function(e,i){var n=this.getCollection(e),o=n&&n.get(i);if(o&&e!==o)throw t.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Duplicate id! Old RelationalModel=%o, new RelationalModel=%o",o,e),new Error("Cannot instantiate more than one Backbone.RelationalModel with the same id per type!")},update:function(e){var t=this.getCollection(e);t.contains(e)||this.register(e),t._onModelEvent("change:"+e.idAttribute,e,t),e.trigger("relational:change:id",e,t)},unregister:function(e){var n,o;e instanceof t.Model?(n=this.getCollection(e),o=[e]):e instanceof t.Collection?(n=this.getCollection(e.model),o=i.clone(e.models)):(n=this.getCollection(e),o=i.clone(n.models)),i.each(o,function(e){this.stopListening(e),i.invoke(e.getRelations(),"stopListening")},this),i.contains(this._collections,e)?n.reset([]):i.each(o,function(e){n.get(e)?n.remove(e):n.trigger("relational:remove",e,n)},this)},reset:function(){this.stopListening(),i.each(this._collections,function(e){this.unregister(e)},this),this._collections=[],this._subModels=[],this._modelScopes=[e]}}),t.Relational.store=new t.Store,t.Relation=function(e,n,o){if(this.instance=e,n=i.isObject(n)?n:{},this.reverseRelation=i.defaults(n.reverseRelation||{},this.options.reverseRelation),this.options=i.defaults(n,this.options,t.Relation.prototype.options),this.reverseRelation.type=i.isString(this.reverseRelation.type)?t[this.reverseRelation.type]||t.Relational.store.getObjectByName(this.reverseRelation.type):this.reverseRelation.type,this.key=this.options.key,this.keySource=this.options.keySource||this.key,this.keyDestination=this.options.keyDestination||this.keySource||this.key,this.model=this.options.model||this.instance.constructor,this.relatedModel=this.options.relatedModel,i.isUndefined(this.relatedModel)&&(this.relatedModel=this.model),!i.isFunction(this.relatedModel)||this.relatedModel.prototype instanceof t.RelationalModel||(this.relatedModel=i.result(this,"relatedModel")),i.isString(this.relatedModel)&&(this.relatedModel=t.Relational.store.getObjectByName(this.relatedModel)),this.checkPreconditions()&&(!this.options.isAutoRelation&&this.reverseRelation.type&&this.reverseRelation.key&&t.Relational.store.addReverseRelation(i.defaults({isAutoRelation:!0,model:this.relatedModel,relatedModel:this.model,reverseRelation:this.options},this.reverseRelation)),e)){var s=this.keySource;s!==this.key&&i.isObject(this.instance.get(this.key))&&(s=this.key),this.setKeyContents(this.instance.get(s)),this.relatedCollection=t.Relational.store.getCollection(this.relatedModel),this.keySource!==this.key&&delete this.instance.attributes[this.keySource],this.instance._relations[this.key]=this,this.initialize(o),this.options.autoFetch&&this.instance.getAsync(this.key,i.isObject(this.options.autoFetch)?this.options.autoFetch:{}),this.listenTo(this.instance,"destroy",this.destroy).listenTo(this.relatedCollection,"relational:add relational:change:id",this.tryAddRelated).listenTo(this.relatedCollection,"relational:remove",this.removeRelated)}},t.Relation.extend=t.Model.extend,i.extend(t.Relation.prototype,t.Events,t.Semaphore,{options:{createModels:!0,includeInJSON:!0,isAutoRelation:!1,autoFetch:!1,parse:!1},instance:null,key:null,keyContents:null,relatedModel:null,relatedCollection:null,reverseRelation:null,related:null,checkPreconditions:function(){var e=this.instance,n=this.key,o=this.model,s=this.relatedModel,r=t.Relational.showWarnings&&"undefined"!=typeof console;if(!o||!n||!s)return r&&console.warn("Relation=%o: missing model, key or relatedModel (%o, %o, %o).",this,o,n,s),!1;if(!(o.prototype instanceof t.RelationalModel))return r&&console.warn("Relation=%o: model does not inherit from Backbone.RelationalModel (%o).",this,e),!1;if(!(s.prototype instanceof t.RelationalModel))return r&&console.warn("Relation=%o: relatedModel does not inherit from Backbone.RelationalModel (%o).",this,s),!1;if(this instanceof t.HasMany&&this.reverseRelation.type===t.HasMany)return r&&console.warn("Relation=%o: relation is a HasMany, and the reverseRelation is HasMany as well.",this),!1;if(e&&i.keys(e._relations).length){var a=i.find(e._relations,function(e){return e.key===n},this);if(a)return r&&console.warn("Cannot create relation=%o on %o for model=%o: already taken by relation=%o.",this,n,e,a),!1}return!0},setRelated:function(e){this.related=e,this.instance.attributes[this.key]=e},_isReverseRelation:function(e){return e.instance instanceof this.relatedModel&&this.reverseRelation.key===e.key&&this.key===e.reverseRelation.key},getReverseRelations:function(e){for(var t=[],n=i.isUndefined(e)?this.related&&(this.related.models||[this.related]):[e],o=null,s=null,r=0;r<(n||[]).length;r++){o=n[r].getRelations()||[];for(var a=0;a<o.length;a++)s=o[a],this._isReverseRelation(s)&&t.push(s)}return t},destroy:function(){this.stopListening(),this instanceof t.HasOne?this.setRelated(null):this instanceof t.HasMany&&this.setRelated(this._prepareCollection()),i.each(this.getReverseRelations(),function(e){e.removeRelated(this.instance)},this)}}),t.HasOne=t.Relation.extend({options:{reverseRelation:{type:"HasMany"}},initialize:function(e){this.listenTo(this.instance,"relational:change:"+this.key,this.onChange);var t=this.findRelated(e);this.setRelated(t),i.each(this.getReverseRelations(),function(t){t.addRelated(this.instance,e)},this)},findRelated:function(e){var t=null;if(e=i.defaults({parse:this.options.parse},e),this.keyContents instanceof this.relatedModel)t=this.keyContents;else if(this.keyContents||0===this.keyContents){var n=i.defaults({create:this.options.createModels},e);t=this.relatedModel.findOrCreate(this.keyContents,n)}return t&&(this.keyId=null),t},setKeyContents:function(e){this.keyContents=e,this.keyId=t.Relational.store.resolveIdForItem(this.relatedModel,this.keyContents)},onChange:function(e,n,o){if(!this.isLocked()){this.acquire(),o=o?i.clone(o):{};var s=i.isUndefined(o.__related),r=s?this.related:o.__related;if(s){this.setKeyContents(n);var a=this.findRelated(o);this.setRelated(a)}if(r&&this.related!==r&&i.each(this.getReverseRelations(r),function(e){e.removeRelated(this.instance,null,o)},this),i.each(this.getReverseRelations(),function(e){e.addRelated(this.instance,o)},this),!o.silent&&this.related!==r){var l=this;this.changed=!0,t.Relational.eventQueue.add(function(){l.instance.trigger("change:"+l.key,l.instance,l.related,o,!0),l.changed=!1})}this.release()}},tryAddRelated:function(e,t,i){!this.keyId&&0!==this.keyId||e.id!==this.keyId||(this.addRelated(e,i),this.keyId=null)},addRelated:function(e,t){var n=this;e.queue(function(){if(e!==n.related){var o=n.related||null;n.setRelated(e),n.onChange(n.instance,e,i.defaults({__related:o},t))}})},removeRelated:function(e,t,n){if(this.related&&e===this.related){var o=this.related||null;this.setRelated(null),this.onChange(this.instance,e,i.defaults({__related:o},n))}}}),t.HasMany=t.Relation.extend({collectionType:null,options:{reverseRelation:{type:"HasOne"},collectionType:t.Collection,collectionKey:!0,collectionOptions:{}},initialize:function(e){if(this.listenTo(this.instance,"relational:change:"+this.key,this.onChange),this.collectionType=this.options.collectionType,!i.isFunction(this.collectionType)||this.collectionType===t.Collection||this.collectionType.prototype instanceof t.Collection||(this.collectionType=i.result(this,"collectionType")),i.isString(this.collectionType)&&(this.collectionType=t.Relational.store.getObjectByName(this.collectionType)),this.collectionType!==t.Collection&&!(this.collectionType.prototype instanceof t.Collection))throw new Error("`collectionType` must inherit from Backbone.Collection");var n=this.findRelated(e);this.setRelated(n)},_prepareCollection:function(e){if(this.related&&this.stopListening(this.related),!(e&&e instanceof t.Collection)){var n=i.isFunction(this.options.collectionOptions)?this.options.collectionOptions(this.instance):this.options.collectionOptions;e=new this.collectionType(null,n)}if(e.model=this.relatedModel,this.options.collectionKey){var o=this.options.collectionKey===!0?this.options.reverseRelation.key:this.options.collectionKey;e[o]&&e[o]!==this.instance?t.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Relation=%o; collectionKey=%s already exists on collection=%o",this,o,this.options.collectionKey):o&&(e[o]=this.instance)}return this.listenTo(e,"relational:add",this.handleAddition).listenTo(e,"relational:remove",this.handleRemoval).listenTo(e,"relational:reset",this.handleReset),e},findRelated:function(e){var n=null;if(e=i.defaults({parse:this.options.parse},e),this.keyContents instanceof t.Collection)this._prepareCollection(this.keyContents),n=this.keyContents;else{var o=[];i.each(this.keyContents,function(t){var n=null;n=t instanceof this.relatedModel?t:this.relatedModel.findOrCreate(t,i.extend({merge:!0},e,{create:this.options.createModels})),n&&o.push(n)},this),n=this.related instanceof t.Collection?this.related:this._prepareCollection(),n.set(o,i.defaults({merge:!1,parse:!1},e))}return this.keyIds=i.difference(this.keyIds,i.pluck(n.models,"id")),n},setKeyContents:function(e){this.keyContents=e instanceof t.Collection?e:null,this.keyIds=[],this.keyContents||!e&&0!==e||(this.keyContents=i.isArray(e)?e:[e],i.each(this.keyContents,function(e){var i=t.Relational.store.resolveIdForItem(this.relatedModel,e);(i||0===i)&&this.keyIds.push(i)},this))},onChange:function(e,n,o){o=o?i.clone(o):{},this.setKeyContents(n),this.changed=!1;var s=this.findRelated(o);if(this.setRelated(s),!o.silent){var r=this;t.Relational.eventQueue.add(function(){r.changed&&(r.instance.trigger("change:"+r.key,r.instance,r.related,o,!0),r.changed=!1)})}},handleAddition:function(e,n,o){o=o?i.clone(o):{},this.changed=!0,i.each(this.getReverseRelations(e),function(e){e.addRelated(this.instance,o)},this);var s=this;!o.silent&&t.Relational.eventQueue.add(function(){s.instance.trigger("add:"+s.key,e,s.related,o)})},handleRemoval:function(e,n,o){o=o?i.clone(o):{},this.changed=!0,i.each(this.getReverseRelations(e),function(e){e.removeRelated(this.instance,null,o)},this);var s=this;!o.silent&&t.Relational.eventQueue.add(function(){s.instance.trigger("remove:"+s.key,e,s.related,o)})},handleReset:function(e,n){var o=this;n=n?i.clone(n):{},!n.silent&&t.Relational.eventQueue.add(function(){o.instance.trigger("reset:"+o.key,o.related,n)})},tryAddRelated:function(e,t,n){var o=i.contains(this.keyIds,e.id);o&&(this.addRelated(e,n),this.keyIds=i.without(this.keyIds,e.id))},addRelated:function(e,t){var n=this;e.queue(function(){n.related&&!n.related.get(e)&&n.related.add(e,i.defaults({parse:!1},t))})},removeRelated:function(e,t,i){this.related.get(e)&&this.related.remove(e,i)}}),t.RelationalModel=t.Model.extend({relations:null,_relations:null,_isInitialized:!1,_deferProcessing:!1,_queue:null,_attributeChangeFired:!1,subModelTypeAttribute:"type",subModelTypes:null,constructor:function(e,n){if(n&&n.collection){var o=this,s=this.collection=n.collection;delete n.collection,this._deferProcessing=!0;var r=function(e){e===o&&(o._deferProcessing=!1,o.processQueue(),s.off("relational:add",r))};s.on("relational:add",r),i.defer(function(){r(o)})}t.Relational.store.processOrphanRelations(),t.Relational.store.listenTo(this,"relational:unregister",t.Relational.store.unregister),this._queue=new t.BlockingQueue,this._queue.block(),t.Relational.eventQueue.block();try{t.Model.apply(this,arguments)}finally{t.Relational.eventQueue.unblock()}},trigger:function(e){if(e.length>5&&0===e.indexOf("change")){var i=this,n=arguments;t.Relational.eventQueue.isLocked()?t.Relational.eventQueue.add(function(){var o=!0;if("change"===e)o=i.hasChanged()||i._attributeChangeFired,i._attributeChangeFired=!1;else{var s=e.slice(7),r=i.getRelation(s);r?(o=n[4]===!0,o?i.changed[s]=n[2]:r.changed||delete i.changed[s]):o&&(i._attributeChangeFired=!0)}o&&t.Model.prototype.trigger.apply(i,n)}):t.Model.prototype.trigger.apply(i,n)}else"destroy"===e?(t.Model.prototype.trigger.apply(this,arguments),t.Relational.store.unregister(this)):t.Model.prototype.trigger.apply(this,arguments);return this},initializeRelations:function(e){this.acquire(),this._relations={},i.each(this.relations||[],function(i){t.Relational.store.initializeRelation(this,i,e)},this),this._isInitialized=!0,this.release(),this.processQueue()},updateRelations:function(e,t){this._isInitialized&&!this.isLocked()&&i.each(this._relations,function(i){if(!e||i.keySource in e||i.key in e){var n=this.attributes[i.keySource]||this.attributes[i.key],o=e&&(e[i.keySource]||e[i.key]);(i.related!==n||null===n&&null===o)&&this.trigger("relational:change:"+i.key,this,n,t||{})}i.keySource!==i.key&&delete this.attributes[i.keySource]},this)},queue:function(e){this._queue.add(e)},processQueue:function(){this._isInitialized&&!this._deferProcessing&&this._queue.isBlocked()&&this._queue.unblock()},getRelation:function(e){return this._relations[e]},getRelations:function(){return i.values(this._relations)},getIdsToFetch:function(e,n){var o=e instanceof t.Relation?e:this.getRelation(e),s=o?o.keyIds&&o.keyIds.slice(0)||(o.keyId||0===o.keyId?[o.keyId]:[]):[];if(n){var r=o.related&&(o.related.models||[o.related]);i.each(r,function(e){(e.id||0===e.id)&&s.push(e.id)})}return s},getAsync:function(e,n){n=i.extend({add:!0,remove:!1,refresh:!1},n);var o=this,s=[],r=this.getRelation(e),a=r&&this.getIdsToFetch(r,n.refresh),l=r.related instanceof t.Collection?r.related:r.relatedCollection;if(a&&a.length){var c,u=[],d=[],h=function(){u=i.map(a,function(e){var t=r.relatedModel.findModel(e);if(!t){var i={};i[r.relatedModel.prototype.idAttribute]=e,t=r.relatedModel.findOrCreate(i,n),d.push(t)}return t},this)};if(l instanceof t.Collection&&i.isFunction(l.url)){var f=l.url();c=l.url(a),c===f&&(h(),c=l.url(u),c===f&&(c=null))}if(c){var p=i.defaults({error:function(){i.each(d,function(e){e.trigger("destroy",e,e.collection,n)}),n.error&&n.error.apply(u,arguments)},url:c},n);s=[l.fetch(p)]}else u.length||h(),s=i.map(u,function(e){var t=i.defaults({error:function(){i.contains(d,e)&&e.trigger("destroy",e,e.collection,n),n.error&&n.error.apply(u,arguments)}},n);return e.fetch(t)},this)}return $.when.apply(null,s).then(function(){return t.Model.prototype.get.call(o,e)})},set:function(e,n,o){t.Relational.eventQueue.block();var s,r;i.isObject(e)||null==e?(s=e,o=n):(s={},s[e]=n);try{var a=this.id,l=s&&this.idAttribute in s&&s[this.idAttribute];t.Relational.store.checkId(this,l),r=t.Model.prototype.set.apply(this,arguments),this._isInitialized||this.isLocked()?l&&l!==a&&t.Relational.store.update(this):(this.constructor.initializeModelHierarchy(),(l||0===l)&&t.Relational.store.register(this),this.initializeRelations(o)),s&&this.updateRelations(s,o)}finally{t.Relational.eventQueue.unblock()}return r},clone:function(){var e=i.clone(this.attributes);return i.isUndefined(e[this.idAttribute])||(e[this.idAttribute]=null),i.each(this.getRelations(),function(t){delete e[t.key]}),new this.constructor(e)},toJSON:function(e){if(this.isLocked())return this.id;this.acquire();var n=t.Model.prototype.toJSON.call(this,e);return!this.constructor._superModel||this.constructor._subModelTypeAttribute in n||(n[this.constructor._subModelTypeAttribute]=this.constructor._subModelTypeValue),i.each(this._relations,function(o){var s=n[o.key],r=o.options.includeInJSON,a=null;r===!0?s&&i.isFunction(s.toJSON)&&(a=s.toJSON(e)):i.isString(r)?(s instanceof t.Collection?a=s.pluck(r):s instanceof t.Model&&(a=s.get(r)),r===o.relatedModel.prototype.idAttribute&&(o instanceof t.HasMany?a=a.concat(o.keyIds):o instanceof t.HasOne&&(a=a||o.keyId,a||i.isObject(o.keyContents)||(a=o.keyContents||null)))):i.isArray(r)?s instanceof t.Collection?(a=[],s.each(function(e){var t={};i.each(r,function(i){t[i]=e.get(i)}),a.push(t)})):s instanceof t.Model&&(a={},i.each(r,function(e){a[e]=s.get(e)})):delete n[o.key],null===a&&e&&e.wait&&(a=s),r&&(n[o.keyDestination]=a),o.keyDestination!==o.key&&delete n[o.key]}),this.release(),n}},{setup:function(){return this.prototype.relations=(this.prototype.relations||[]).slice(0),this._subModels={},this._superModel=null,this.prototype.hasOwnProperty("subModelTypes")?t.Relational.store.addSubModels(this.prototype.subModelTypes,this):this.prototype.subModelTypes=null,i.each(this.prototype.relations||[],function(e){if(e.model||(e.model=this),e.reverseRelation&&e.model===this){var n=!0;if(i.isString(e.relatedModel)){var o=t.Relational.store.getObjectByName(e.relatedModel);n=o&&o.prototype instanceof t.RelationalModel}n?t.Relational.store.initializeRelation(null,e):i.isString(e.relatedModel)&&t.Relational.store.addOrphanRelation(e)}},this),this},build:function(e,t){this.initializeModelHierarchy();var i=this._findSubModelType(this,e)||this;return new i(e,t)},_findSubModelType:function(e,t){if(e._subModels&&e.prototype.subModelTypeAttribute in t){var i=t[e.prototype.subModelTypeAttribute],n=e._subModels[i];if(n)return n;for(i in e._subModels)if(n=this._findSubModelType(e._subModels[i],t))return n}return null},initializeModelHierarchy:function(){if(this.inheritRelations(),this.prototype.subModelTypes){var e=i.keys(this._subModels),n=i.omit(this.prototype.subModelTypes,e);i.each(n,function(e){var i=t.Relational.store.getObjectByName(e);i&&i.initializeModelHierarchy()})}},inheritRelations:function(){if(i.isUndefined(this._superModel)||i.isNull(this._superModel))if(t.Relational.store.setupSuperModel(this),this._superModel){if(this._superModel.inheritRelations(),this._superModel.prototype.relations){var e=i.filter(this._superModel.prototype.relations||[],function(e){return!i.any(this.prototype.relations||[],function(t){return e.relatedModel===t.relatedModel&&e.key===t.key},this)},this);this.prototype.relations=e.concat(this.prototype.relations)}}else this._superModel=!1},findOrCreate:function(e,t){t||(t={});var n=i.isObject(e)&&t.parse&&this.prototype.parse?this.prototype.parse(i.clone(e)):e,o=this.findModel(n);return i.isObject(e)&&(o&&t.merge!==!1?(delete t.collection,delete t.url,o.set(n,t)):o||t.create===!1||(o=this.build(n,i.defaults({parse:!1},t)))),o},find:function(e,t){return t||(t={}),t.create=!1,this.findOrCreate(e,t)},findModel:function(e){return t.Relational.store.find(this,e)}}),i.extend(t.RelationalModel.prototype,t.Semaphore),t.Collection.prototype.__prepareModel=t.Collection.prototype._prepareModel,t.Collection.prototype._prepareModel=function(e,n){var o;return e instanceof t.Model?(e.collection||(e.collection=this),o=e):(n=n?i.clone(n):{},n.collection=this,o="undefined"!=typeof this.model.findOrCreate?this.model.findOrCreate(e,n):new this.model(e,n),o&&o.validationError&&(this.trigger("invalid",this,e,n),o=!1)),o};var n=t.Collection.prototype.__set=t.Collection.prototype.set;t.Collection.prototype.set=function(e,o){if(!(this.model.prototype instanceof t.RelationalModel))return n.call(this,e,o);o&&o.parse&&(e=this.parse(e,o));var s=!i.isArray(e),r=[],a=[],l=null;e=s?e?[e]:[]:i.clone(e);for(var c=0;c<e.length;c++)l=e[c],l instanceof t.Model||(l=t.Collection.prototype._prepareModel.call(this,l,o)),l&&(a.push(l),this.get(l)||this.get(l.cid)?null!==l.id&&void 0!==l.id&&(this._byId[l.id]=l):r.push(l));a=s?a.length?a[0]:null:a;var u=n.call(this,a,i.defaults({merge:!1,parse:!1},o));for(c=0;c<r.length;c++)l=r[c],(this.get(l)||this.get(l.cid))&&this.trigger("relational:add",l,this,o);
return u};var o=t.Collection.prototype.__remove=t.Collection.prototype.remove;t.Collection.prototype.remove=function(e,n){if(!(this.model.prototype instanceof t.RelationalModel))return o.call(this,e,n);var s=!i.isArray(e),r=[];e=s?e?[e]:[]:i.clone(e),n||(n={}),i.each(e,function(e){e=this.get(e)||e&&this.get(e.cid),e&&r.push(e)},this);var a=o.call(this,s?r.length?r[0]:null:r,n);return i.each(r,function(e){this.trigger("relational:remove",e,this,n)},this),a};var s=t.Collection.prototype.__reset=t.Collection.prototype.reset;t.Collection.prototype.reset=function(e,n){n=i.extend({merge:!0},n);var o=s.call(this,e,n);return this.model.prototype instanceof t.RelationalModel&&this.trigger("relational:reset",this,n),o};var r=t.Collection.prototype.__sort=t.Collection.prototype.sort;t.Collection.prototype.sort=function(e){var i=r.call(this,e);return this.model.prototype instanceof t.RelationalModel&&this.trigger("relational:reset",this,e),i};var a=t.Collection.prototype.__trigger=t.Collection.prototype.trigger;t.Collection.prototype.trigger=function(e){if(!(this.model.prototype instanceof t.RelationalModel))return a.apply(this,arguments);if("add"===e||"remove"===e||"reset"===e||"sort"===e){var n=this,o=arguments;i.isObject(o[3])&&(o=i.toArray(o),o[3]=i.clone(o[3])),t.Relational.eventQueue.add(function(){a.apply(n,o)})}else a.apply(this,arguments);return this},t.RelationalModel.extend=function(e,i){var n=t.Model.extend.call(this,e,i);return n.setup(this),n}}),function(){var e,t,i,n,o,s,r,a,l,c,u=this;"undefined"==typeof window?(e=require("underscore"),t=require("backbone"),"undefined"!=typeof exports&&(exports=module.exports=t)):(e=u._,t=u.Backbone),i=t.Model,n=t.Collection,o=i.prototype,s=n.prototype,l=/[\.\[\]]+/g,r="change add remove reset sort destroy".split(" "),c=["reset","sort"],t.Associations={VERSION:"0.5.0"},t.Associations.Many=t.Many="Many",t.Associations.One=t.One="One",a=t.AssociatedModel=t.Associations.AssociatedModel=i.extend({relations:void 0,_proxyCalls:void 0,get:function(e){var t=o.get.call(this,e);return t?t:this._getAttr.apply(this,arguments)},set:function(t,i,n){var o;return e.isObject(t)||null==t?(o=t,n=i):(o={},o[t]=i),t=this._set(o,n),this._processPendingEvents(),t},_set:function(t,i){var n,o,s,r,c=this;if(!t)return this;for(n in t)if(o||(o={}),n.match(l)){var u=h(n);r=e.initial(u),u=u[u.length-1],r=this.get(r),r instanceof a&&(r=o[r.cid]||(o[r.cid]={model:r,data:{}}),r.data[u]=t[n])}else r=o[this.cid]||(o[this.cid]={model:this,data:{}}),r.data[n]=t[n];if(o)for(s in o)r=o[s],this._setAttr.call(r.model,r.data,i)||(c=!1);else c=this._setAttr.call(this,t,i);return c},_setAttr:function(i,s){var r;if(s||(s={}),s.unset)for(r in i)i[r]=void 0;return this.parents=this.parents||[],this.relations&&e.each(this.relations,function(o){var r,l,c,u,d=o.key,h=o.relatedModel,p=o.collectionType,g=o.map,m=this.attributes[d],v=m&&m.idAttribute;if(h&&e.isString(h)&&(h=f(h)),p&&e.isString(p)&&(p=f(p)),g&&e.isString(g)&&(g=f(g)),l=o.options?e.extend({},o.options,s):s,i[d]){if(r=e.result(i,d),r=g?g(r):r,o.type===t.Many){if(p&&!p.prototype instanceof n)throw Error("collectionType must inherit from Backbone.Collection");r instanceof n?c=r:m?(m._deferEvents=!0,m.set(r,s),c=m):(c=p?new p:this._createCollection(h),c.add(r,l))}else o.type===t.One&&h&&(r instanceof a?c=r:m?m&&r[v]&&m.get(v)===r[v]?(m._deferEvents=!0,m._set(r,s),c=m):c=new h(r,l):c=new h(r,l));(u=i[d]=c)&&!u._proxyCallback&&(u._proxyCallback=function(){return this._bubbleEvent.call(this,d,u,arguments)},u.on("all",u._proxyCallback,this))}i.hasOwnProperty(d)&&(o=i[d],h=this.attributes[d],o?(o.parents=o.parents||[],-1==e.indexOf(o.parents,this)&&o.parents.push(this)):h&&h.parents.length>0&&(h.parents=e.difference(h.parents,[this])))},this),o.set.call(this,i,s)},_bubbleEvent:function(t,i,o){var s,l=o[0].split(":"),u=l[0],d="nested-change"==o[0],f=o[1],p=o[2],g=-1,m=i._proxyCalls,v=-1!==e.indexOf(r,u);if(!d){if(e.size(l)>1&&(s=l[1]),-1!==e.indexOf(c,u)&&(p=f),i instanceof n&&v&&f){var y=h(s),b=e.initial(y);(l=i.find(function(e){if(f===e)return!0;if(!e)return!1;var t=e.get(b);return(t instanceof a||t instanceof n)&&f===t?!0:(t=e.get(y),(t instanceof a||t instanceof n)&&f===t||t instanceof n&&p&&p===t?!0:void 0)}))&&(g=i.indexOf(l))}return s=t+(-1===g||"change"!==u&&!s?"":"["+g+"]")+(s?"."+s:""),/\[\*\]/g.test(s)?this:(l=s.replace(/\[\d+\]/g,"[*]"),g=[],g.push.apply(g,o),g[0]=u+":"+s,m=i._proxyCalls=m||{},this._isEventAvailable.call(this,m,s)?this:(m[s]=!0,"change"===u&&(this._previousAttributes[t]=i._previousAttributes,this.changed[t]=i),this.trigger.apply(this,g),"change"===u&&this.get(s)!=o[2]&&this.trigger.apply(this,["nested-change",s,o[1]]),m&&s&&delete m[s],s!==l&&(g[0]=u+":"+l,this.trigger.apply(this,g)),this))}},_isEventAvailable:function(t,i){return e.find(t,function(e,t){return-1!==i.indexOf(t,i.length-t.length)})},_createCollection:function(t){var i=t;if(e.isString(i)&&(i=f(i)),!(i&&i.prototype instanceof a))throw Error("type must inherit from Backbone.AssociatedModel");return t=new n,t.model=i,t},_processPendingEvents:function(){this.visited||(this.visited=!0,this._deferEvents=!1,e.each(this._pendingEvents,function(e){e.c.trigger.apply(e.c,e.a)}),this._pendingEvents=[],e.each(this.relations,function(e){(e=this.attributes[e.key])&&e._processPendingEvents()},this),delete this.visited)},trigger:function(){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):o.trigger.apply(this,arguments)},toJSON:function(t){var i,n;return this.visited||(this.visited=!0,i=o.toJSON.apply(this,arguments),this.relations&&e.each(this.relations,function(o){var s=this.attributes[o.key];s&&(n=s.toJSON(t),i[o.key]=e.isArray(n)?e.compact(n):n)},this),delete this.visited),i},clone:function(){return new this.constructor(this.toJSON())},_getAttr:function(t){var i,o,s=this,t=h(t);if(!(e.size(t)<1)){for(o=0;o<t.length&&(i=t[o],s);o++)s=s instanceof n?isNaN(i)?void 0:s.at(i):s.attributes[i];return s}}});var d=/[^\.\[\]]+/g,h=function(t){return""===t?[""]:e.isString(t)?t.match(d):t||[]},f=function(t){return e.reduce(t.split("."),function(e,t){return e[t]},u)},p=function(t,i,n){var o;return e.find(t,function(t){return(o=e.find(t.relations,function(e){return t.get(e.key)===i},this))?!0:void 0},this),o&&o.map?o.map(n):n},g={};e.each(["set","remove","reset"],function(e){g[e]=n.prototype[e],s[e]=function(t){return this.model.prototype instanceof a&&this.parents&&(arguments[0]=p(this.parents,this,t)),g[e].apply(this,arguments)}}),g.trigger=s.trigger,s.trigger=function(){this._deferEvents?(this._pendingEvents=this._pendingEvents||[],this._pendingEvents.push({c:this,a:arguments})):g.trigger.apply(this,arguments)},s._processPendingEvents=a.prototype._processPendingEvents}.call(this),define("backbone.associations",["backbone"],function(e){return function(){var t;return t||e.Backbone.Associations}}(this)),function(){this.AjaxPrefix={addAjaxPrefix:function(e,t){return e.postWithPrefix=function(e,i,n,o){return $.post(""+t()+e,i,n,o)},e.getWithPrefix=function(e,i,n,o){return $.get(""+t()+e,i,n,o)},e.ajaxWithPrefix=function(e,i){return null!=i?$.ajax(""+t()+e,i):(i=e,i.url=""+t()+i.url,$.ajax(i))}}}}.call(this),define("coffee/src/ajax_prefix",function(){}),define("js/utils/templates",["jquery","underscore"],function(e,t){var i=function(i){var n="#"+i+"-tpl",o=e(n).text();return o||console.error("Failed to load "+i+" template"),t.template(o)};return{loadTemplate:i}}),define("js/views/feedback",["jquery","underscore","underscore.string","backbone","js/utils/templates"],function(e,t,i,n,o){var s=n.View.extend({options:{title:"",message:"",intent:null,type:null,shown:!0,icon:!0,closeIcon:!0,minShown:0,maxShown:1/0},initialize:function(){if(!this.options.type)throw"SystemFeedback: type required (given "+JSON.stringify(this.options)+")";if(!this.options.intent)throw"SystemFeedback: intent required (given "+JSON.stringify(this.options)+")";return this.template=o.loadTemplate("system-feedback"),this.setElement(e("#page-"+this.options.type)),this.options.actions&&this.options.actions.secondary&&!t.isArray(this.options.actions.secondary)&&(this.options.actions.secondary=[this.options.actions.secondary]),this},show:function(){return clearTimeout(this.hideTimeout),this.options.shown=!0,this.shownAt=new Date,this.render(),e.isNumeric(this.options.maxShown)&&(this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.maxShown)),this},hide:function(){return this.shownAt&&e.isNumeric(this.options.minShown)&&this.options.minShown>new Date-this.shownAt?(clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(t.bind(this.hide,this),this.options.minShown-(new Date-this.shownAt))):(this.options.shown=!1,delete this.shownAt,this.render()),this},events:{"click .action-close":"hide","click .action-primary":"primaryClick","click .action-secondary":"secondaryClick"},render:function(){var e=s["active_"+this.options.type];return e&&e!==this&&(e.stopListening(),e.undelegateEvents()),this.$el.html(this.template(this.options)),s["active_"+this.options.type]=this,this},primaryClick:function(e){var t,i;t=this.options.actions,t&&(i=t.primary,i&&(i.preventDefault!==!1&&e.preventDefault(),i.click&&i.click.call(e.target,this,e)))},secondaryClick:function(e){var i,n,o,s;i=this.options.actions,i&&(n=i.secondary,n&&(s=0,e&&e.target&&(s=t.indexOf(this.$(".action-secondary"),e.target)),o=n[s],o.preventDefault!==!1&&e.preventDefault(),o.click&&o.click.call(e.target,this,e)))}});return s}),define("js/views/feedback_notification",["jquery","underscore","underscore.string","js/views/feedback"],function(e,t,i,n){var o,s,r=n.extend({options:e.extend({},n.prototype.options,{type:"notification",closeIcon:!1})});o=t.compose(i.capitalize,i.camelize),s=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(s,function(t){var i;i=r.extend({options:e.extend({},r.prototype.options,{intent:t})}),r[o(t)]=i});var a=r.Mini.prototype.options;return a.minShown=1250,a.closeIcon=!1,r}),function(e){e.cookie=function(t,i,n){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(i))||null===i||void 0===i)){if(n=e.extend({},n),(null===i||void 0===i)&&(n.expires=-1),"number"==typeof n.expires){var o=n.expires,s=n.expires=new Date;s.setDate(s.getDate()+o)}return i=String(i),document.cookie=[encodeURIComponent(t),"=",n.raw?i:encodeURIComponent(i),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("")}n=i||{};for(var r,a=n.raw?function(e){return e}:decodeURIComponent,l=document.cookie.split("; "),c=0;r=l[c]&&l[c].split("=");c++)if(a(r[0])===t)return a(r[1]||"");return null}}(jQuery),define("jquery.cookie",["jquery"],function(e){return function(){var t;return t||e.jQuery.fn.cookie}}(this)),function(){define("coffee/src/main",["domReady","jquery","underscore.string","backbone","gettext","js/views/feedback_notification","coffee/src/ajax_prefix","jquery.cookie"],function(e,t,i,n,o,s){var r;return r=function(){return AjaxPrefix.addAjaxPrefix(jQuery,function(){return t("meta[name='path_prefix']").attr("content")}),window.CMS=window.CMS||{},CMS.URL=CMS.URL||{},window.onTouchBasedDevice=function(){return navigator.userAgent.match(/iPhone|iPod|iPad|Android/i)},_.extend(CMS,n.Events),n.emulateHTTP=!0,t.ajaxSetup({headers:{"X-CSRFToken":t.cookie("csrftoken")},dataType:"json"}),t(document).ajaxError(function(e,t,n){var r,a;if(n.notifyOnError!==!1){if(t.responseText)try{r=JSON.parse(t.responseText).error}catch(l){r=i.truncate(t.responseText,300)}else r=o("This may be happening because of an error with our server or your internet connection. Try refreshing the page or making sure you are online.");return a=new s.Error({title:o("Studio's having trouble saving your work"),message:r}),a.show()}}),t.postJSON=function(e,i,n){return t.isFunction(i)&&(n=i,i=void 0),t.ajax({url:e,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(i),success:n})},e(function(){return onTouchBasedDevice()?t("body").addClass("touch-based-device"):void 0})},r(),r})}.call(this),define("js/certificates/models/signatory",["underscore","underscore.string","backbone","backbone-relational","gettext"],function(e,t,i,n,o){e.str=t;var s=i.RelationalModel.extend({idAttribute:"id",defaults:{name:"Name of the signatory",title:"Title of the signatory",organization:"Organization of the signatory",signature_image_path:""},initialize:function(){return this.setOriginalAttributes(),this},parse:function(e){return e},validate:function(t){var i=null;if(e.has(t,"name")&&t.name.length>40&&(i=e.extend({name:o("Signatory name should not be more than 40 characters long.")},i)),e.has(t,"title")){var n=t.title,s=n.split(/\r\n|\r|\n/);s.length>2?i=e.extend({title:o("Signatory title should span over maximum of 2 lines.")},i):(s.length>1&&(s[0].length>40||s[1].length>40)||1===s.length&&n.length>40)&&(i=e.extend({title:o("Signatory title should have maximum of 40 characters per line.")},i))}return e.has(t,"organization")&&t.organization.length>40&&(i=e.extend({organization:o("Signatory organization should not be more than 40 characters long.")},i)),null!==i?i:void 0},setOriginalAttributes:function(){this._originalAttributes=this.parse(this.toJSON())}});return s}),define("js/certificates/collections/signatories",["backbone","js/certificates/models/signatory"],function(e,t){var i=e.Collection.extend({model:t});return i}),define("js/certificates/models/certificate",["underscore","underscore.string","backbone","backbone-relational","backbone.associations","gettext","coffee/src/main","js/certificates/models/signatory","js/certificates/collections/signatories"],function(e,t,i,n,o,s,r,a,l){e.str=t;var c=i.RelationalModel.extend({idAttribute:"id",defaults:{course_title:"",org_logo_path:"",name:"Name of the certificate",description:"Description of the certificate",version:1,is_active:!1},relations:[{type:i.HasMany,key:"signatories",relatedModel:a,collectionType:l,reverseRelation:{key:"certificate",includeInJSON:"id"}}],initialize:function(e,t){return this.canBeEmpty=t&&t.canBeEmpty,t.add&&(e.signatories=new a({certificate:this})),this.setOriginalAttributes(),this},parse:function(e){return e},setOriginalAttributes:function(){this._originalAttributes=this.parse(this.toJSON()),this.isNew()||this.get("signatories").url||(this.get("signatories").url=this.collection.url+"/"+this.get("id")+"/signatories")},validate:function(t){if(!e.str.trim(t.name))return{message:s("Certificate name is required."),attributes:{name:!0}};var i=e.every(t.signatories.models,function(e){return e.isValid()});return i?void 0:{message:s("Signatory field(s) has invalid data."),attributes:{signatories:t.signatories.models}}},reset:function(){this.set(this._originalAttributes,{parse:!0,validate:!0})}});return c}),define("js/certificates/collections/certificates",["backbone","gettext","js/certificates/models/certificate"],function(e,t,i){var n=e.Collection.extend({model:i,maxAllowed:1,initialize:function(e,t){this.url=t.certificateUrl,this.bind("remove",this.onModelRemoved,this),this.bind("add",this.onModelAdd,this)},certificate_array:function(e){var i;try{i=JSON.parse(e)}catch(n){"object"==typeof e?i=e:(console.error(interpolate(t("Could not parse certificate JSON. %(message)s"),{message:n.message},!0)),i=[])}return i},onModelRemoved:function(){window.certWebPreview&&0===this.length&&window.certWebPreview.remove(),this.toggleAddNewItemButtonState()},onModelAdd:function(){this.toggleAddNewItemButtonState()},toggleAddNewItemButtonState:function(){this.length>=this.maxAllowed?$(".action-add").addClass("action-add-hidden"):$(".action-add").removeClass("action-add-hidden")},parse:function(e){var t=this.certificate_array(e);for(var i in t)t.hasOwnProperty(i)&&this.push(t[i]);return this.models}});return n}),define("js/utils/handle_iframe_binding",["jquery"],function(e){var t=function(t){var n=null;n="undefined"==typeof t?e("iframe, embed"):"undefined"!=typeof t.nodeName?e(t).find("iframe, embed"):t.$("iframe, embed"),i(n)},i=function(t){t.each(function(){if("IFRAME"===e(this).prop("tagName")){var t=e(this).attr("src");if(t){var i="wmode=transparent";if(-1!==t.indexOf("?")){var n=t.split("?");if(-1===n[1].search("wmode=transparent")){var o=n[1],s=n[0];e(this).attr("src",s+"?"+i+"&"+o)}}else 0!==t.lastIndexOf("javascript:",0)&&e(this).attr("src",t+"?"+i)}}else e(this).attr("wmode","transparent")})},n=function(t){if(t){var n=null,o=document.createElement("div");e(o).html(t),n=e(o).find("iframe, embed"),n.length>0&&(i(n),t=e(o).html())}return t};return{iframeBinding:t,iframeBindingHtml:n}}),define("js/views/feedback_prompt",["jquery","underscore","underscore.string","js/views/feedback"],function(e,t,i,n){var o,s,r=n.extend({options:e.extend({},n.prototype.options,{type:"prompt",closeIcon:!1,icon:!1}),render:function(){return window.$body||(window.$body=e(document.body)),this.options.shown?$body.addClass("prompt-is-shown"):$body.removeClass("prompt-is-shown"),n.prototype.render.apply(this,arguments)}});return o=t.compose(i.capitalize,i.camelize),s=["warning","error","confirmation","announcement","step-required","help","mini"],t.each(s,function(t){var i;i=r.extend({options:e.extend({},r.prototype.options,{intent:t})}),r[o(t)]=i}),r}),define("js/views/utils/view_utils",["jquery","underscore","gettext","js/views/feedback_notification","js/views/feedback_prompt"],function(e,t,i,n,o){var s,r,a,l,c,u,d,h,f,p,g,m,v,y,b,w,_,x=65;return s=function(e,t){t||(t="collapsed"),e.closest(".expand-collapse").toggleClass("expand collapse"),e.closest(".is-collapsible, .window").toggleClass(t),e.closest(".is-collapsible").children("article").slideToggle()},r=function(){e(".ui-loading").show()},a=function(){e(".ui-loading").hide()},l=function(e,t,n,s,r){return new o.Warning({title:e,message:t,actions:{primary:{text:n,click:function(e){e.hide(),s()}},secondary:{text:i("Cancel"),click:function(e){return r&&r(),e.hide()}}}}).show()},c=function(e,t){var o;return o=new n.Mini({title:i(e)}),o.show(),t().done(function(){o.hide()})},u=function(e,t){return e.addClass("is-disabled").attr("aria-disabled",!0),t().always(function(){e.removeClass("is-disabled").attr("aria-disabled",!1)})},v=function(t){return function(i){i.preventDefault(),e.ajax({url:e(this).data("dismiss-link"),type:"DELETE",success:t})}},f=function(t){e("html, body").animate({scrollTop:t},500)},d=function(t){var i=t.offset().top;return i-e(window).scrollTop()},h=function(e,t){var i=e.offset().top,n=i-t;f(n)},p=function(e){window.location=e},g=function(){window.location.reload()},m=function(e,i){var n,o=e.changedAttributes();if(!o)return!1;for(n=0;n<i.length;n++)if(t.has(o,i[n]))return!0;return!1},y=function(e){return 0===e.length?i("Required field."):""},b=function(e,t){var n=y(e);if(n)return n;if(t){if(/\s/g.test(e))return i("Please do not use any spaces in this field.")}else if(e!==encodeURIComponent(e)||e.match(/[!'()*]/))return i("Please do not use any spaces or special characters in this field.");return""},w=function(i){var n=t.reduce(i,function(t,i){return t+e(i).val().length},0);return x>=n},_=function(i,n,o,s){w(o)?e(i.errorWrapper).removeClass(n.shown).addClass(n.hiding):(e(i.errorWrapper).addClass(n.shown).removeClass(n.hiding),e(i.errorMessage).html("<p>"+t.template(s,{limit:x})+"</p>"),e(i.save).addClass(n.disabled))},{toggleExpandCollapse:s,showLoadingIndicator:r,hideLoadingIndicator:a,confirmThenRunOperation:l,runOperationShowingMessage:c,disableElementWhileRunning:u,deleteNotificationHandler:v,setScrollTop:f,getScrollOffset:d,setScrollOffset:h,redirect:p,reload:g,hasChangedAttributes:m,validateRequiredField:y,validateURLItemEncoding:b,validateTotalKeyLength:w,checkTotalKeyLengthViolations:_}}),define("js/views/baseview",["jquery","underscore","backbone","gettext","js/utils/handle_iframe_binding","js/utils/templates","js/views/utils/view_utils"],function(e,t,i,n,o,s,r){var a=i.View.extend({events:{"click .ui-toggle-expansion":"toggleExpandCollapse"},options:{collapsedClass:"collapsed"},constructor:function(){t.bindAll(this,"beforeRender","render","afterRender");var e=this;this.render=t.wrap(this.render,function(t,i){return e.beforeRender(),t(i),e.afterRender(),e}),i.View.prototype.constructor.apply(this,arguments)},beforeRender:function(){},render:function(){return this},afterRender:function(){o.iframeBinding(this)},toggleExpandCollapse:function(t){var i=e(t.target);t.stopPropagation(),t.preventDefault(),r.toggleExpandCollapse(i,this.options.collapsedClass)},loadTemplate:function(e){return s.loadTemplate(e)}});return a}),define("js/views/pages/base_page",["jquery","js/views/baseview"],function(e,t){var i=t.extend({initialize:function(){t.prototype.initialize.call(this)},hasContent:function(){return!0},renderPage:function(){return e.Deferred().resolve().promise()},render:function(){var e=this;return this.$(".ui-loading").removeClass("is-hidden"),this.renderPage().done(function(){e.hasContent()||e.$(".no-content").removeClass("is-hidden")}).always(function(){e.$(".ui-loading").addClass("is-hidden")}),this}});return i}),define("js/views/list",["js/views/baseview"],function(e){var t=e.extend({events:{"click .action-add":"onAddItem","click .new-button":"onAddItem"},listContainerCss:".list-items",initialize:function(){this.listenTo(this.collection,"add",this.addNewItemView),this.listenTo(this.collection,"remove",this.onRemoveItem),this.template=this.loadTemplate("list"),this.listenTo(this.collection,"change:editing",this.toggleAddButton),this.listenTo(this.collection,"add",this.toggleAddButton),this.listenTo(this.collection,"remove",this.toggleAddButton)},render:function(e){return this.$el.html(this.template({itemCategoryDisplayName:this.itemCategoryDisplayName,emptyMessage:this.emptyMessage,length:this.collection.length,isEditing:e&&e.get("editing"),canCreateNewItem:this.canCreateItem(this.collection)})),this.collection.each(function(e){this.$(this.listContainerCss).append(this.createItemView({model:e}).render().el)},this),this},hideOrShowAddButton:function(e){var t=".action-add";this.collection.length&&(e?this.$(t).removeClass("is-hidden"):this.$(t).addClass("is-hidden"))},toggleAddButton:function(e){this.hideOrShowAddButton(e.get("editing")&&this.collection.contains(e)?!1:!0)},addNewItemView:function(e){var t=this.createItemView({model:e});this.collection.length>1?this.$(this.listContainerCss).append(t.render().el):this.render(),t.$el.focus()},canCreateItem:function(e){var t=!0;if(e.length>0){var i=e.maxAllowed;!_.isUndefined(i)&&e.length>=i&&(t=!1)}return t},onAddItem:function(e){e&&e.preventDefault&&e.preventDefault(),this.collection.add({editing:!0},this.newModelOptions)},onRemoveItem:function(){0===this.collection.length&&this.render()}});return t}),define("js/views/list_item",["js/views/baseview","jquery","gettext","js/views/utils/view_utils"],function(e,t,i,n){var o=e.extend({canDelete:!1,initialize:function(){this.listenTo(this.model,"change:editing",this.render),this.listenTo(this.model,"remove",this.remove)},className:function(){var e=this.model.collection.indexOf(this.model);return["wrapper-collection","wrapper-collection-"+e,this.baseClassName,this.baseClassName+"s-list-item",this.baseClassName+"s-list-item-"+e].join(" ")},deleteItem:function(e){if(e&&e.preventDefault&&e.preventDefault(),this.canDelete){var t=this.model,o=this.itemDisplayName;n.confirmThenRunOperation(interpolate(i("Delete this %(item_display_name)s?"),{item_display_name:o},!0),interpolate(i("Deleting this %(item_display_name)s is permanent and cannot be undone."),{item_display_name:o},!0),i("Delete"),function(){return n.runOperationShowingMessage(i("Deleting"),function(){return t.destroy({wait:!0})})})}},render:function(){return this.view&&this.view.remove(),this.view=this.model.get("editing")?this.createEditView():this.createDetailsView(),this.$el.html(this.view.render().el),this}});return o}),define("js/models/uploads",["backbone","underscore","gettext"],function(e,t,i){var n=e.Model.extend({defaults:{title:"",message:"",selectedFile:null,uploading:!1,uploadedBytes:0,totalBytes:0,finished:!1,mimeTypes:[],fileFormats:[]},validate:function(e){return e.selectedFile&&!this.checkTypeValidity(e.selectedFile)?{message:t.template(i("Only <%= fileTypes %> files can be uploaded. Please select a file ending in <%= fileExtensions %> to upload."),this.formatValidTypes()),attributes:{selectedFile:!0}}:void 0},fileTypes:function(){var e=t.map(this.attributes.mimeTypes,function(e){return e.split("/")[1].toUpperCase()}),i=t.map(this.attributes.fileFormats,function(e){return e.toUpperCase()});return e.concat(i)},checkTypeValidity:function(e){var i=this.attributes,n=function(e){return RegExp("(?:.+)\\.("+e.join("|")+")$","i")};return 0===i.mimeTypes.length&&0===i.fileFormats.length||t.contains(i.mimeTypes,e.type)||n(i.fileFormats).test(e.name)},formatValidTypes:function(){var e=this.attributes;if(1===e.mimeTypes.concat(e.fileFormats).length)return{fileTypes:this.fileTypes()[0],fileExtensions:"."+this.fileTypes()[0].toLowerCase()};var n=i("or"),o=function(e){return t.template("<%= initial %> <%= or %> <%= last %>",{initial:t.initial(e).join(", "),or:n,last:t.last(e)})};return{fileTypes:o(this.fileTypes()),fileExtensions:o(t.map(this.fileTypes(),function(e){return"."+e.toLowerCase()}))}}});return n}),define("js/views/modals/base_modal",["jquery","underscore","gettext","js/views/baseview"],function(e,t,i,n){var o=n.extend({events:{"click .action-cancel":"cancel"},options:e.extend({},n.prototype.options,{type:"prompt",closeIcon:!1,icon:!1,modalName:"basic",modalType:"generic",modalSize:"lg",title:"",viewSpecificClasses:""}),initialize:function(){var t=this.options.parent,i=this.options.parentElement;this.modalTemplate=this.loadTemplate("basic-modal"),this.buttonTemplate=this.loadTemplate("modal-button"),t?i=t.$el:i||(i=this.$el.closest(".modal-window"),0===i.length&&(i=e("body"))),this.parentElement=i},render:function(){this.$el.html(this.modalTemplate({name:this.options.modalName,type:this.options.modalType,size:this.options.modalSize,title:this.getTitle(),viewSpecificClasses:this.options.viewSpecificClasses})),this.addActionButtons(),this.renderContents(),this.parentElement.append(this.$el)},getTitle:function(){return this.options.title},renderContents:function(){var e=this.getContentHtml();this.$(".modal-content").html(e)},getContentHtml:function(){return""},show:function(){this.render(),this.resize(),e(window).resize(t.bind(this.resize,this))},hide:function(){this.undelegateEvents(),this.$el.html("")},cancel:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.hide()},addActionButtons:function(){this.options.addSaveButton&&this.addActionButton("save",i("Save"),!0),this.addActionButton("cancel",i("Cancel"))},addActionButton:function(e,t,i){var n=this.buttonTemplate({type:e,name:t,isPrimary:i});this.getActionBar().find("ul").append(n)},getActionBar:function(){return this.$(".modal-window > div > .modal-actions")},getActionButton:function(e){return this.getActionBar().find(".action-"+e)},resize:function(){var t,i,n,o,s,r,a,l,c;n=this.$(".modal-window"),r=e(window).width(),a=e(window).height(),l=.8*r,c=.8*a,o=Math.min(n.outerWidth(),l),s=Math.min(n.outerHeight(),c),i=(r-o)/2,t=(a-s)/2,n.css({top:t+e(window).scrollTop(),left:i+e(window).scrollLeft()})}});return o}),function(e){function t(t){var i=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(this).ajaxSubmit(i))}function i(t){var i=t.target,n=e(i);if(!n.is(":submit,input:image")){var o=n.closest(":submit");if(0===o.length)return;i=o[0]}var s=this;if(s.clk=i,"image"==i.type)if(void 0!==t.offsetX)s.clk_x=t.offsetX,s.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var r=n.offset();s.clk_x=t.pageX-r.left,s.clk_y=t.pageY-r.top}else s.clk_x=t.pageX-i.offsetLeft,s.clk_y=t.pageY-i.offsetTop;setTimeout(function(){s.clk=s.clk_x=s.clk_y=null},100)}function n(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var o={};o.fileapi=void 0!==e("<input type='file'/>").get(0).files,o.formdata=void 0!==window.FormData,e.fn.ajaxSubmit=function(t){function i(t){var i,n,o=e.param(t).split("&"),s=o.length,r={};for(i=0;s>i;i++)n=o[i].split("="),r[decodeURIComponent(n[0])]=decodeURIComponent(n[1]);return r}function s(n){for(var o=new FormData,s=0;s<n.length;s++)o.append(n[s].name,n[s].value);if(t.extraData){var r=i(t.extraData);for(var l in r)r.hasOwnProperty(l)&&o.append(l,r[l])}t.data=null;var c=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:a||"POST"});t.uploadProgress&&(c.xhr=function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&(e.upload.onprogress=function(e){var i=0,n=e.loaded||e.position,o=e.total;e.lengthComputable&&(i=Math.ceil(n/o*100)),t.uploadProgress(e,n,o,i)}),e}),c.data=null;var u=c.beforeSend;return c.beforeSend=function(e,t){t.data=o,u&&u.call(this,e,t)},e.ajax(c)}function r(i){function o(e){var t=e.contentWindow?e.contentWindow.document:e.contentDocument?e.contentDocument:e.document;return t}function s(){function t(){try{var e=o(m).readyState;n("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(i){n("Server abort: ",i," (",i.name,")"),r(M),_&&clearTimeout(_),_=void 0}}var i=u.attr("target"),s=u.attr("action");x.setAttribute("target",f),a||x.setAttribute("method","POST"),s!=d.url&&x.setAttribute("action",d.url),d.skipEncodingOverride||a&&!/post/i.test(a)||u.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),d.timeout&&(_=setTimeout(function(){w=!0,r(R)},d.timeout));var l=[];try{if(d.extraData)for(var c in d.extraData)d.extraData.hasOwnProperty(c)&&l.push(e.isPlainObject(d.extraData[c])&&d.extraData[c].hasOwnProperty("name")&&d.extraData[c].hasOwnProperty("value")?e('<input type="hidden" name="'+d.extraData[c].name+'">').attr("value",d.extraData[c].value).appendTo(x)[0]:e('<input type="hidden" name="'+c+'">').attr("value",d.extraData[c]).appendTo(x)[0]);d.iframeTarget||(g.appendTo("body"),m.attachEvent?m.attachEvent("onload",r):m.addEventListener("load",r,!1)),setTimeout(t,15),x.submit()}finally{x.setAttribute("action",s),i?x.setAttribute("target",i):u.removeAttr("target"),e(l).remove()}}function r(t){if(!v.aborted&&!O){try{A=o(m)}catch(i){n("cannot access response document: ",i),t=M}if(t===R&&v)return v.abort("timeout"),void C.reject(v,"timeout");if(t==M&&v)return v.abort("server abort"),void C.reject(v,"error","server abort");if(A&&A.location.href!=d.iframeSrc||w){m.detachEvent?m.detachEvent("onload",r):m.removeEventListener("load",r,!1);var s,a="success";try{if(w)throw"timeout";var l="xml"==d.dataType||A.XMLDocument||e.isXMLDoc(A);if(n("isXml="+l),!l&&window.opera&&(null===A.body||!A.body.innerHTML)&&--D)return n("requeing onLoad callback, DOM not available"),void setTimeout(r,250);var c=A.body?A.body:A.documentElement;v.responseText=c?c.innerHTML:null,v.responseXML=A.XMLDocument?A.XMLDocument:A,l&&(d.dataType="xml"),v.getResponseHeader=function(e){var t={"content-type":d.dataType};return t[e]},c&&(v.status=Number(c.getAttribute("status"))||v.status,v.statusText=c.getAttribute("statusText")||v.statusText);var u=(d.dataType||"").toLowerCase(),f=/(json|script|text)/.test(u);if(f||d.textarea){var p=A.getElementsByTagName("textarea")[0];if(p)v.responseText=p.value,v.status=Number(p.getAttribute("status"))||v.status,v.statusText=p.getAttribute("statusText")||v.statusText;else if(f){var y=A.getElementsByTagName("pre")[0],b=A.getElementsByTagName("body")[0];y?v.responseText=y.textContent?y.textContent:y.innerText:b&&(v.responseText=b.textContent?b.textContent:b.innerText)}}else"xml"==u&&!v.responseXML&&v.responseText&&(v.responseXML=E(v.responseText));try{T=I(v,u,d)}catch(t){a="parsererror",v.error=s=t||a}}catch(t){n("error caught: ",t),a="error",v.error=s=t||a}v.aborted&&(n("upload aborted"),a=null),v.status&&(a=v.status>=200&&v.status<300||304===v.status?"success":"error"),"success"===a?(d.success&&d.success.call(d.context,T,"success",v),C.resolve(v.responseText,"success",v),h&&e.event.trigger("ajaxSuccess",[v,d])):a&&(void 0===s&&(s=v.statusText),d.error&&d.error.call(d.context,v,a,s),C.reject(v,"error",s),h&&e.event.trigger("ajaxError",[v,d,s])),h&&e.event.trigger("ajaxComplete",[v,d]),h&&!--e.active&&e.event.trigger("ajaxStop"),d.complete&&d.complete.call(d.context,v,a),O=!0,d.timeout&&clearTimeout(_),setTimeout(function(){d.iframeTarget||g.remove(),v.responseXML=null
},100)}}}var l,c,d,h,f,g,m,v,y,b,w,_,x=u[0],k=!!e.fn.prop,C=e.Deferred();if(e(":input[name=submit],:input[id=submit]",x).length)return alert('Error: Form elements must not have name or id of "submit".'),C.reject(),C;if(i)for(c=0;c<p.length;c++)l=e(p[c]),k?l.prop("disabled",!1):l.removeAttr("disabled");if(d=e.extend(!0,{},e.ajaxSettings,t),d.context=d.context||d,f="jqFormIO"+(new Date).getTime(),d.iframeTarget?(g=e(d.iframeTarget),b=g.attr("name"),b?f=b:g.attr("name",f)):(g=e('<iframe name="'+f+'" src="'+d.iframeSrc+'" />'),g.css({position:"absolute",top:"-1000px",left:"-1000px"})),m=g[0],v={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var i="timeout"===t?"timeout":"aborted";if(n("aborting upload... "+i),this.aborted=1,m.contentWindow.document.execCommand)try{m.contentWindow.document.execCommand("Stop")}catch(o){}g.attr("src",d.iframeSrc),v.error=i,d.error&&d.error.call(d.context,v,i,t),h&&e.event.trigger("ajaxError",[v,d,i]),d.complete&&d.complete.call(d.context,v,i)}},h=d.global,h&&0===e.active++&&e.event.trigger("ajaxStart"),h&&e.event.trigger("ajaxSend",[v,d]),d.beforeSend&&d.beforeSend.call(d.context,v,d)===!1)return d.global&&e.active--,C.reject(),C;if(v.aborted)return C.reject(),C;y=x.clk,y&&(b=y.name,b&&!y.disabled&&(d.extraData=d.extraData||{},d.extraData[b]=y.value,"image"==y.type&&(d.extraData[b+".x"]=x.clk_x,d.extraData[b+".y"]=x.clk_y)));var R=1,M=2,S=e("meta[name=csrf-token]").attr("content"),j=e("meta[name=csrf-param]").attr("content");j&&S&&(d.extraData=d.extraData||{},d.extraData[j]=S),d.forceSync?s():setTimeout(s,10);var T,A,O,D=50,E=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},N=e.parseJSON||function(e){return window.eval("("+e+")")},I=function(t,i,n){var o=t.getResponseHeader("content-type")||"",s="xml"===i||!i&&o.indexOf("xml")>=0,r=s?t.responseXML:t.responseText;return s&&"parsererror"===r.documentElement.nodeName&&e.error&&e.error("parsererror"),n&&n.dataFilter&&(r=n.dataFilter(r,i)),"string"==typeof r&&("json"===i||!i&&o.indexOf("json")>=0?r=N(r):("script"===i||!i&&o.indexOf("javascript")>=0)&&e.globalEval(r)),r};return C}if(!this.length)return n("ajaxSubmit: skipping submit process - no element selected"),this;var a,l,c,u=this;"function"==typeof t&&(t={success:t}),a=this.attr("method"),l=this.attr("action"),c="string"==typeof l?e.trim(l):"",c=c||window.location.href||"",c&&(c=(c.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:c,success:e.ajaxSettings.success,type:a||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var d={};if(this.trigger("form-pre-serialize",[this,t,d]),d.veto)return n("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&t.beforeSerialize(this,t)===!1)return n("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var h=t.traditional;void 0===h&&(h=e.ajaxSettings.traditional);var f,p=[],g=this.formToArray(t.semantic,p);if(t.data&&(t.extraData=t.data,f=e.param(t.data,h)),t.beforeSubmit&&t.beforeSubmit(g,this,t)===!1)return n("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[g,this,t,d]),d.veto)return n("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var m=e.param(g,h);f&&(m=m?m+"&"+f:f),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+m,t.data=null):t.data=m;var v=[];if(t.resetForm&&v.push(function(){u.resetForm()}),t.clearForm&&v.push(function(){u.clearForm(t.includeHidden)}),!t.dataType&&t.target){var y=t.success||function(){};v.push(function(i){var n=t.replaceTarget?"replaceWith":"html";e(t.target)[n](i).each(y,arguments)})}else t.success&&v.push(t.success);t.success=function(e,i,n){for(var o=t.context||this,s=0,r=v.length;r>s;s++)v[s].apply(o,[e,i,n||u,u])};var b=e("input:file:enabled[value]",this),w=b.length>0,_="multipart/form-data",x=u.attr("enctype")==_||u.attr("encoding")==_,k=o.fileapi&&o.formdata;n("fileAPI :"+k);var C,R=(w||x)&&!k;t.iframe!==!1&&(t.iframe||R)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){C=r(g)}):C=r(g):C=(w||x)&&k?s(g):e.ajax(t),u.removeData("jqxhr").data("jqxhr",C);for(var M=0;M<p.length;M++)p[M]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(o){if(o=o||{},o.delegation=o.delegation&&e.isFunction(e.fn.on),!o.delegation&&0===this.length){var s={s:this.selector,c:this.context};return!e.isReady&&s.s?(n("DOM not ready, queuing ajaxForm"),e(function(){e(s.s,s.c).ajaxForm(o)}),this):(n("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return o.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,i).on("submit.form-plugin",this.selector,o,t).on("click.form-plugin",this.selector,o,i),this):this.ajaxFormUnbind().bind("submit.form-plugin",o,t).bind("click.form-plugin",o,i)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,i){var n=[];if(0===this.length)return n;var s=this[0],r=t?s.getElementsByTagName("*"):s.elements;if(!r)return n;var a,l,c,u,d,h,f;for(a=0,h=r.length;h>a;a++)if(d=r[a],c=d.name)if(t&&s.clk&&"image"==d.type)d.disabled||s.clk!=d||(n.push({name:c,value:e(d).val(),type:d.type}),n.push({name:c+".x",value:s.clk_x},{name:c+".y",value:s.clk_y}));else if(u=e.fieldValue(d,!0),u&&u.constructor==Array)for(i&&i.push(d),l=0,f=u.length;f>l;l++)n.push({name:c,value:u[l]});else if(o.fileapi&&"file"==d.type&&!d.disabled){i&&i.push(d);var p=d.files;if(p.length)for(l=0;l<p.length;l++)n.push({name:c,value:p[l],type:d.type});else n.push({name:c,value:"",type:d.type})}else null!==u&&"undefined"!=typeof u&&(i&&i.push(d),n.push({name:c,value:u,type:d.type,required:d.required}));if(!t&&s.clk){var g=e(s.clk),m=g[0];c=m.name,c&&!m.disabled&&"image"==m.type&&(n.push({name:c,value:g.val()}),n.push({name:c+".x",value:s.clk_x},{name:c+".y",value:s.clk_y}))}return n},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var i=[];return this.each(function(){var n=this.name;if(n){var o=e.fieldValue(this,t);if(o&&o.constructor==Array)for(var s=0,r=o.length;r>s;s++)i.push({name:n,value:o[s]});else null!==o&&"undefined"!=typeof o&&i.push({name:this.name,value:o})}}),e.param(i)},e.fn.fieldValue=function(t){for(var i=[],n=0,o=this.length;o>n;n++){var s=this[n],r=e.fieldValue(s,t);null===r||"undefined"==typeof r||r.constructor==Array&&!r.length||(r.constructor==Array?e.merge(i,r):i.push(r))}return i},e.fieldValue=function(t,i){var n=t.name,o=t.type,s=t.tagName.toLowerCase();if(void 0===i&&(i=!0),i&&(!n||t.disabled||"reset"==o||"button"==o||("checkbox"==o||"radio"==o)&&!t.checked||("submit"==o||"image"==o)&&t.form&&t.form.clk!=t||"select"==s&&-1==t.selectedIndex))return null;if("select"==s){var r=t.selectedIndex;if(0>r)return null;for(var a=[],l=t.options,c="select-one"==o,u=c?r+1:l.length,d=c?r:0;u>d;d++){var h=l[d];if(h.selected){var f=h.value;if(f||(f=h.attributes&&h.attributes.value&&!h.attributes.value.specified?h.text:h.value),c)return f;a.push(f)}}return a}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var i=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var n=this.type,o=this.tagName.toLowerCase();i.test(n)||"textarea"==o?this.value="":"checkbox"==n||"radio"==n?this.checked=!1:"select"==o?this.selectedIndex=-1:t&&(t===!0&&/hidden/.test(n)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var i=this.type;if("checkbox"==i||"radio"==i)this.checked=t;else if("option"==this.tagName.toLowerCase()){var n=e(this).parent("select");t&&n[0]&&"select-one"==n[0].type&&n.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}(jQuery),define("jquery.form",["jquery"],function(e){return function(){var t;return t||e.jQuery.fn.ajaxForm}}(this)),define("js/views/uploads",["jquery","underscore","gettext","js/views/modals/base_modal","jquery.form"],function(e,t,i,n){var o=n.extend({events:{"change input[type=file]":"selectFile","click .action-upload":"upload"},options:e.extend({},n.prototype.options,{modalName:"assetupload",modalSize:"med",successMessageTimeout:2e3,viewSpecificClasses:"confirm"}),initialize:function(){n.prototype.initialize.call(this),this.events=t.extend({},n.prototype.events,this.events),this.template=this.loadTemplate("upload-dialog"),this.listenTo(this.model,"change",this.renderContents),this.options.title=this.model.get("title")},addActionButtons:function(){this.addActionButton("upload",i("Upload"),!0),n.prototype.addActionButtons.call(this)},renderContents:function(){var t=this.model.isValid(),i=this.model.get("selectedFile"),o=this.$("input[type=file]").get(0);return n.prototype.renderContents.call(this),i&&t?(e(o).removeClass("error"),this.$("input[type=file]").replaceWith(o),this.$(".action-upload").removeClass("disabled")):this.$(".action-upload").addClass("disabled"),this},getContentHtml:function(){return this.template({url:this.options.url||CMS.URL.UPLOAD_ASSET,message:this.model.escape("message"),selectedFile:this.model.get("selectedFile"),uploading:this.model.get("uploading"),uploadedBytes:this.model.get("uploadedBytes"),totalBytes:this.model.get("totalBytes"),finished:this.model.get("finished"),error:this.model.validationError})},selectFile:function(t){var i=t.target.files[0]||null;this.model.set({selectedFile:i}),i&&e.isEmptyObject(this.model.changed)&&this.model.trigger("change")},upload:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("uploading",!0),this.$("form").ajaxSubmit({success:t.bind(this.success,this),error:t.bind(this.error,this),uploadProgress:t.bind(this.progress,this),data:{notifyOnError:!1}})},progress:function(e,t,i){this.model.set({uploadedBytes:t,totalBytes:i})},success:function(e,t,i,n){this.model.set({uploading:!1,finished:!0}),this.options.onSuccess&&this.options.onSuccess(e,t,i,n);var o=this;this.removalTimeout=setTimeout(function(){o.hide()},this.options.successMessageTimeout)},error:function(){this.model.set({uploading:!1,uploadedBytes:0,title:i("We're sorry, there was an error")})}});return o}),define("js/certificates/views/signatory_editor",["jquery","underscore","backbone","gettext","js/utils/templates","js/views/utils/view_utils","js/views/feedback_prompt","js/views/feedback_notification","js/models/uploads","js/views/uploads"],function(e,t,i,n,o,s,r,a,l,c){var u=i.View.extend({tagName:"div",events:{"change .signatory-name-input":"setSignatoryName","change .signatory-title-input":"setSignatoryTitle","change .signatory-organization-input":"setSignatoryOrganization","click  .signatory-panel-delete":"deleteItem","change .signatory-signature-input":"setSignatorySignatureImagePath","click .action-upload-signature":"uploadSignatureImage"},className:function(){var e=this.getModelIndex(this.model);return["signatory-edit","signatory-edit-view-"+e].join(" ")},initialize:function(e){t.bindAll(this,"render"),this.model.bind("change",this.render),this.eventAgg=e.eventAgg,this.isEditingAllCollections=e.isEditingAllCollections,this.template=this.loadTemplate("signatory-editor")},getModelIndex:function(e){return this.model.collection.indexOf(e)},loadTemplate:function(e){return o.loadTemplate(e)},getTotalSignatoriesOnServer:function(){var e=0;return this.model.collection.each(function(t){t.isNew()||e++}),e},render:function(){var t=e.extend({modelIsValid:this.model.isValid(),error:this.model.validationError},this.model.attributes,{signatory_number:this.getModelIndex(this.model)+1,signatories_count:this.model.collection.length,isNew:this.model.isNew(),is_editing_all_collections:this.isEditingAllCollections,total_saved_signatories:this.getTotalSignatoriesOnServer()});return e(this.el).html(this.template(t))},setSignatoryName:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("name",this.$(".signatory-name-input").val()),this.eventAgg.trigger("onSignatoryUpdated",this.model)},setSignatoryTitle:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("title",this.$(".signatory-title-input").val()),this.eventAgg.trigger("onSignatoryUpdated",this.model)},setSignatoryOrganization:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("organization",this.$(".signatory-organization-input").val()),this.eventAgg.trigger("onSignatoryUpdated",this.model)},setSignatorySignatureImagePath:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("signature_image_path",this.$(".signatory-signature-input").val(),{silent:!0})},deleteItem:function(e){e&&e.preventDefault&&e.preventDefault();var i=this.model,o=this,s=n('Delete "<%= signatoryName %>" from the list of signatories?'),l=new r.Warning({title:t.template(s,{signatoryName:i.get("name")}),message:n("This action cannot be undone."),actions:{primary:{text:n("Delete"),click:function(){var e=new a.Mini({title:n("Deleting")});i.isNew()?(i.collection.remove(i),o.eventAgg.trigger("onSignatoryRemoved",i)):(e.show(),i.destroy({wait:!0,success:function(t){e.hide(),o.eventAgg.trigger("onSignatoryRemoved",t)}})),l.hide()}},secondary:{text:n("Cancel"),click:function(){l.hide()}}}});l.show()},uploadSignatureImage:function(e){e.preventDefault();var t=new l({title:n("Upload signature image."),message:n("Image must be 450px X 150px transparent PNG."),mimeTypes:["image/png"]}),i=this,o=new c({model:t,onSuccess:function(e){i.model.set("signature_image_path",e.asset.url)}});o.show()}});return u}),define("js/certificates/views/signatory_details",["jquery","underscore","underscore.string","backbone","gettext","js/utils/templates","js/views/utils/view_utils","js/views/baseview","js/certificates/views/signatory_editor"],function(e,t,i,n,o,s,r,a,l){var c=a.extend({tagName:"div",events:{"click .edit-signatory":"editSignatory","click  .signatory-panel-save":"saveSignatoryData","click  .signatory-panel-close":"closeSignatoryEditView"},className:function(){var e=this.model.collection.indexOf(this.model);return["signatory-details","signatory-details-view-"+e].join(" ")},initialize:function(){this.eventAgg=t.extend({},n.Events),this.edit_view=new l({model:this.model,isEditingAllCollections:!1,eventAgg:this.eventAgg}),this.template=this.loadTemplate("signatory-details")},loadTemplate:function(e){return s.loadTemplate(e)},editSignatory:function(e){e&&e.preventDefault&&e.preventDefault(),this.$el.html(this.edit_view.render()),this.edit_view.delegateEvents(),this.delegateEvents()},saveSignatoryData:function(t){t&&t.preventDefault&&t.preventDefault();var i=this.model.get("certificate");if(i.isValid()){var n=this;r.runOperationShowingMessage(o("Saving"),function(){var t=e.Deferred(),o=i;return o.save({},{success:function(){o.setOriginalAttributes(),t.resolve(),n.closeSignatoryEditView()}.bind(this)}),t}.bind(this))}},closeSignatoryEditView:function(e){e&&e.preventDefault&&e.preventDefault(),this.render()},render:function(){var t=e.extend({},this.model.attributes,{signatory_number:this.model.collection.indexOf(this.model)+1});return e(this.el).html(this.template(t))}});return c}),define("js/certificates/views/certificate_details",["jquery","underscore","underscore.string","gettext","js/views/baseview","js/certificates/models/signatory","js/certificates/views/signatory_details"],function(e,t,i,n,o,s,r){var a=o.extend({tagName:"div",events:{"click .edit":"editCertificate"},className:function(){return["collection","certificates","certificate-details"].join(" ")},initialize:function(){this.showDetails=!0,this.template=this.loadTemplate("certificate-details"),this.listenTo(this.model,"change",this.render)},editCertificate:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("editing",!0)},render:function(t){var i=e.extend({},this.model.attributes,{index:this.model.collection.indexOf(this.model),showDetails:this.showDetails||t||!1});if(this.$el.html(this.template(i)),this.showDetails||t){var n=this;this.model.get("signatories").each(function(t){var i=new r({model:t});n.$("div.signatory-details-list").append(e(i.render().$el))})}return this.model.collection.length>0&&window.certWebPreview&&window.certWebPreview.show(),this}});return a}),define("js/views/list_item_editor",["js/views/baseview","js/views/utils/view_utils","underscore","gettext"],function(e,t,i,n){var o=e.extend({initialize:function(){this.listenTo(this.model,"invalid",this.render),this.listenTo(this.getSaveableModel(),"invalid",this.render)},render:function(){this.$el.html(this.template(i.extend({error:this.model.validationError||this.getSaveableModel().validationError},this.getTemplateOptions())))},setAndClose:function(e){return e&&e.preventDefault&&e.preventDefault(),this.setValues(),this.model.isValid()&&this.getSaveableModel().isValid()?void t.runOperationShowingMessage(n("Saving"),function(){var e=$.Deferred(),t=this.getSaveableModel();return t.save({},{success:function(){t.setOriginalAttributes(),this.close(),e.resolve()}.bind(this)}),e}.bind(this)):!1},cancel:function(e){return e&&e.preventDefault&&e.preventDefault(),this.getSaveableModel().reset(),this.close()},close:function(){return this.remove(),this.model.isNew()&&!i.isUndefined(this.model.collection)?this.model.collection.remove(this.model):this.model.set("editing",!1),this}});return o}),define("js/certificates/views/certificate_editor",["jquery","underscore","backbone","gettext","js/views/list_item_editor","js/certificates/models/signatory","js/certificates/views/signatory_editor","js/models/uploads","js/views/uploads"],function(e,t,i,n,o,s,r,a,l){var c=4,u=o.extend({tagName:"div",events:{"change .collection-name-input":"setName","change .certificate-description-input":"setDescription","change .certificate-course-title-input":"setCourseTitle","change .org-logo-input":"setOrgLogoPath","focus .input-text":"onFocus","blur .input-text":"onBlur",submit:"setAndClose","click .action-cancel":"cancel","click .action-add-signatory":"addSignatory","click .action-upload-org-logo":"uploadLogoImage"},className:function(){var e=this.model.collection.indexOf(this.model);return["collection-edit","certificates","certificate-edit","certificate-edit-"+e].join(" ")},initialize:function(){t.bindAll(this,"onSignatoryRemoved","clearErrorMessage"),this.eventAgg=t.extend({},i.Events),this.eventAgg.bind("onSignatoryRemoved",this.onSignatoryRemoved),this.eventAgg.bind("onSignatoryUpdated",this.clearErrorMessage),o.prototype.initialize.call(this),this.template=this.loadTemplate("certificate-editor")},onSignatoryRemoved:function(){this.model.setOriginalAttributes(),this.render()},clearErrorMessage:function(){this.$(".certificate-edit-error").remove()},render:function(){o.prototype.render.call(this);var t=this;return this.model.get("signatories").each(function(i){var n=new r({model:i,isEditingAllCollections:!0,eventAgg:t.eventAgg});t.$("div.signatory-edit-list").append(e(n.render()))}),this.disableAddSignatoryButton(),this},addSignatory:function(){new s({certificate:this.getSaveableModel()});this.render()},disableAddSignatoryButton:function(){this.$(".signatory-edit-list > div.signatory-edit").length>=c&&this.$(".action-add-signatory").addClass("disableClick")},getTemplateOptions:function(){return{id:this.model.get("id"),uniqueId:t.uniqueId(),name:this.model.escape("name"),description:this.model.escape("description"),course_title:this.model.escape("course_title"),org_logo_path:this.model.escape("org_logo_path"),isNew:this.model.isNew()}},getSaveableModel:function(){return this.model},setName:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("name",this.$(".collection-name-input").val(),{silent:!0})},setDescription:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("description",this.$(".certificate-description-input").val(),{silent:!0})},setCourseTitle:function(e){e&&e.preventDefault&&e.preventDefault(),this.model.set("course_title",this.$(".certificate-course-title-input").val(),{silent:!0})},setOrgLogoPath:function(e){e&&e.preventDefault&&e.preventDefault();var t=this.$(".org-logo-input").val();this.model.set("org_logo_path",t,{silent:!0}),this.$(".current-org-logo img.org-logo").attr("src",t)},setValues:function(){return this.setName(),this.setDescription(),this.setCourseTitle(),this.setOrgLogoPath(),this},uploadLogoImage:function(e){e.preventDefault();var t=new a({title:n("Upload organization logo."),message:n("Maximum logo height should be 125px."),mimeTypes:["image/png","image/jpeg"]}),i=this,o=new l({model:t,onSuccess:function(e){var t=e.asset.url;i.model.set("org_logo_path",t),i.$(".current-org-logo img.org-logo").attr("src",t),i.$(".current-org-logo").show(),i.$("input.org-logo-input").attr("value",t)}});o.show()}});return u}),define("js/certificates/views/certificate_item",["gettext","js/views/list_item","js/certificates/views/certificate_details","js/certificates/views/certificate_editor"],function(e,t,i,n){var o=t.extend({events:{"click .delete":"deleteItem"},tagName:"section",baseClassName:"certificate",canDelete:!0,itemDisplayName:e("certificate"),attributes:function(){return{id:this.model.get("id"),tabindex:-1}},createEditView:function(){return new n({model:this.model})},createDetailsView:function(){return new i({model:this.model})}});return o}),define("js/certificates/views/certificates_list",["gettext","js/views/list","js/certificates/views/certificate_item"],function(e,t,i){var n=t.extend({tagName:"div",className:"certificates-list",newModelOptions:{},itemCategoryDisplayName:e("certificate"),emptyMessage:e("You have not created any certificates yet."),createItemView:function(e){return new i(e)}});return n}),define("js/certificates/views/certificates_page",["jquery","underscore","gettext","js/views/pages/base_page","js/certificates/views/certificates_list"],function(e,t,i,n,o){var s=n.extend({initialize:function(e){n.prototype.initialize.call(this),this.certificatesCollection=e.certificatesCollection,this.certificatesListView=new o({collection:this.certificatesCollection})},renderPage:function(){return this.$(".wrapper-certificates.certificates-list").append(this.certificatesListView.render().el),e.Deferred().resolve().promise()}});return s}),define("js/certificates/views/certificate_preview",["underscore","gettext","js/views/baseview","js/views/utils/view_utils","js/views/feedback_notification"],function(e,t,i,n,o){var s=i.extend({el:$(".preview-certificate"),events:{"change #course-modes":"courseModeChanged","click .activate-cert":"toggleCertificateActivation"},initialize:function(e){this.course_modes=e.course_modes,this.certificate_web_view_url=e.certificate_web_view_url,this.certificate_activation_handler_url=e.certificate_activation_handler_url,this.is_active=e.is_active,this.template=this.loadTemplate("certificate-web-preview")},render:function(){return this.$el.html(this.template({course_modes:this.course_modes,certificate_web_view_url:this.certificate_web_view_url,is_active:this.is_active})),this},toggleCertificateActivation:function(){var e="Activating";this.is_active&&(e="Deactivating");var i=new o.Mini({title:t(e)});$.ajax({url:this.certificate_activation_handler_url,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({is_active:!this.is_active}),beforeSend:function(){i.show()},success:function(){i.hide(),location.reload()}})},courseModeChanged:function(e){$(".preview-certificate-link").attr("href",function(t,i){return i.replace(/preview=([^&]+)/,function(){return"preview="+e.target.options[e.target.selectedIndex].text})})},show:function(){this.render()},remove:function(){return this.is_active=!1,this.$el.empty(),this}});return s}),define("js/certificates/factories/certificates_page_factory",["jquery","js/certificates/collections/certificates","js/certificates/models/certificate","js/certificates/views/certificates_page","js/certificates/views/certificate_preview"],function(e,t,i,n,o){return function(i,s,r,a,l,c,u){var d=new t(i,{parse:!0,canBeEmpty:!0,certificateUrl:s});!window.certWebPreview&&l&&(window.certWebPreview=new o({course_modes:a,certificate_web_view_url:l,certificate_activation_handler_url:u,is_active:c})),new n({el:e("#content"),certificatesCollection:d}).render()}});